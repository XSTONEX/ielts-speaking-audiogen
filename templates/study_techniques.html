<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Â≠¶‰π†ÊäÄÂ∑ß</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/static/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/android-chrome-512x512.png">
  
  <link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- MarkdownËß£ÊûêÂ∫ìÂíåÁõ∏ÂÖ≥‰æùËµñ -->
  <script src="https://cdn.jsdelivr.net/npm/marked@5.1.1/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
  
  <style>
    body { 
      font-family: 'PT Serif', 'Crimson Text', ui-serif, 'Times New Roman', 'Georgia', serif; 
      background: linear-gradient(135deg, #e0e7ff 0%, #f4f6fa 100%); 
      margin: 0; 
      min-height: 100vh; 
      padding: 20px; 
      box-sizing: border-box; 
    }
    
    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      background: #fff; 
      border-radius: 20px; 
      box-shadow: 0 16px 48px rgba(31,38,135,0.20); 
      padding: 24px; 
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .header h1 { 
      margin: 0; 
      color: #1f2937; 
      font-size: 28px; 
      letter-spacing: 0.3px; 
    }
    
    .back-btn {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      color: #374151;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .back-btn:hover {
      background: #e5e7eb;
      transform: translateY(-1px);
    }
    
    .categories {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .category-tab {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
      flex: none;
      min-width: 100px;
    }
    
    .category-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }
    
    .category-tab:hover:not(.active) {
      border-color: #c7d2fe;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(31,38,135,0.1);
    }
    
    .category-icon {
      font-size: 16px;
      margin-right: 6px;
    }
    
    .category-name {
      font-weight: 600;
      font-size: 14px;
      display: inline;
    }
    
    .category-desc {
      display: none;
    }
    
    .content-area {
      display: none;
    }
    
    .content-area.active {
      display: block;
    }
    
    .modules {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 24px;
    }
    
    .module {
      background: #fafafa;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 20px;
      min-height: 400px;
      position: relative;
      z-index: 1;
    }
    
    .module.techniques {
      grid-column: 1 / -1;
      min-height: 300px;
    }
    
    .module-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }
    
    .module-title {
      font-weight: 700;
      font-size: 18px;
      color: #1f2937;
    }
    
    .add-btn {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
    }
    
    .add-btn:hover {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .add-btn:active {
      transform: translateY(0);
    }
    
    .items {
      max-height: 350px;
      overflow-y: visible;
      overflow-x: hidden;
    }
    
    .item {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      transition: all 0.2s;
    }
    
    .item:hover {
      box-shadow: 0 2px 8px rgba(31,38,135,0.1);
    }
    
    .word-item {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .word-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .word-group-title {
      font-weight: 600;
      color: #1f2937;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.2s;
    }

    .word-group-title:hover {
      color: #60a5fa;
    }

    .word-group-title.editing {
      border: 1px solid #60a5fa;
      border-radius: 4px;
      padding: 4px 8px;
      background: white;
      outline: none;
    }

    .word-main {
      flex: 1;
    }
    
    .word-primary {
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 4px;
      cursor: pointer;
      transition: color 0.2s;
      position: relative;
    }
    
    .word-primary:hover {
      color: #60a5fa;
    }
    
    .word-clickable {
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      padding: 2px 6px;
      border-radius: 4px;
      display: inline-block;
    }
    
    .word-clickable:hover {
      background: #eff6ff;
      color: #3b82f6;
    }
    
    
    /* ÂçïËØçÂíåËØç‰πâ‰∏§Ë°åÂ∏ÉÂ±Ä */
    .word-with-definition {
      display: inline-block;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 8px 12px;
      margin: 4px;
      transition: all 0.2s ease;
      min-width: 120px;
      vertical-align: top;
    }

    .word-with-definition:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .word-text {
      font-weight: 600;
      color: #1e293b;
      font-size: 14px;
      margin-bottom: 4px;
      text-align: center;
    }

    .word-definition {
      font-size: 12px;
      color: #64748b;
      line-height: 1.4;
      text-align: center;
      font-style: italic;
    }

    .synonyms {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: flex-start;
      align-items: flex-start;
    }

    .hypernym-chain {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      justify-content: flex-start;
    }

    .hypernym-separator {
      color: #64748b;
      font-size: 14px;
      font-weight: 500;
    }

    .hypernym-arrow {
      color: #60a5fa;
      font-size: 16px;
      font-weight: bold;
      margin: 0 8px;
    }
    
    .word-definition {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 8px;
    }
    
    .synonyms {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    
    .synonym {
      background: #f3f4f6;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 12px;
      color: #374151;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .synonym:hover {
      background: #60a5fa;
      color: white;
    }
    
    .hypernym-chain {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .hypernym-arrow {
      color: #9ca3af;
      font-size: 14px;
    }
    
    .hypernym-word {
      background: #f0f9ff;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 13px;
      color: #0369a1;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #bae6fd;
    }
    
    .hypernym-word:hover {
      background: #0369a1;
      color: white;
    }
    
    .hypernym-word.target {
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }
    
    .technique-item {
      border-left: 4px solid #60a5fa;
      padding-left: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .technique-item:hover {
      background: #f8fafc;
      border-radius: 8px;
    }
    
    .technique-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .technique-title {
      font-weight: 600;
      color: #1f2937;
      font-size: 16px;
    }
    
    .technique-toggle {
      background: none;
      border: none;
      color: #6b7280;
      cursor: pointer;
      font-size: 14px;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .technique-toggle:hover {
      background: #e5e7eb;
      color: #374151;
    }
    
    
    /* ÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 2000;
      overflow-y: auto;
    }
    
    .fullscreen-modal.show {
      display: block;
    }
    
    .fullscreen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      border-bottom: 1px solid #e5e7eb;
      background: #f9fafb;
      position: sticky;
      top: 0;
      z-index: 100;
      flex-wrap: wrap;
      gap: 12px;
    }

    .fullscreen-left {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
      min-width: 200px;
    }

    .fullscreen-sort-controls {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .fullscreen-title {
      font-size: 24px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }
    
    .fullscreen-actions {
      display: flex;
      gap: 12px;
    }
    
    .fullscreen-main {
      display: flex;
      gap: 40px;
      align-items: flex-start;
      padding: 40px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .fullscreen-content {
      flex: 1;
      line-height: 1.8;
      font-size: 16px;
      min-width: 0;
    }

    /* ÂÖ®Â±èËØçÊ±áÊòæÁ§∫Ê†∑Âºè */
    .fullscreen-content .word-with-definition {
      display: inline-block;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 12px 16px;
      margin: 6px;
      transition: all 0.2s ease;
      min-width: 120px;
      vertical-align: top;
      font-size: 16px;
    }

    .fullscreen-content .word-with-definition:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .fullscreen-content .word-text {
      font-weight: 600;
      color: #1e293b;
      font-size: 16px;
      margin-bottom: 6px;
      text-align: center;
    }

    .fullscreen-content .word-definition {
      font-size: 14px;
      color: #64748b;
      line-height: 1.4;
      text-align: center;
      font-style: italic;
    }

    .fullscreen-content .hypernym-chain {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      justify-content: center;
      padding: 8px;
    }

    .fullscreen-content .hypernym-separator {
      color: #64748b;
      font-size: 16px;
      font-weight: 500;
    }

    .fullscreen-content .hypernym-arrow {
      color: #60a5fa;
      font-size: 18px;
      font-weight: bold;
      margin: 0 12px;
    }
    
    .fullscreen-edit-area {
      display: none;
      padding: 40px;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .fullscreen-edit-area.active {
      display: block;
    }
    
    .fullscreen-textarea {
      width: 100%;
      min-height: 500px;
      padding: 20px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      line-height: 1.6;
      resize: vertical;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .fullscreen-close {
      background: #6b7280;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    .fullscreen-close:hover {
      background: #4b5563;
    }
    
    .fullscreen-edit-btn, .fullscreen-save-btn {
      background: #60a5fa;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    .fullscreen-edit-btn:hover, .fullscreen-save-btn:hover {
      background: #60a5fa;
    }
    
    /* MarkdownÂÜÖÂÆπÊ†∑Âºè */
    .technique-content {
      line-height: 1.8;
      color: #374151;
      margin-top: 12px;
      display: none;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .technique-content.expanded {
      display: block;
    }

    /* MarkdownÂÖÉÁ¥†Ê†∑Âºè */
    .technique-content h1,
    .technique-content h2,
    .technique-content h3,
    .technique-content h4,
    .technique-content h5,
    .technique-content h6 {
      color: #1f2937;
      margin-top: 1.5em;
      margin-bottom: 0.5em;
      font-weight: 600;
    }

    .technique-content h1 { font-size: 1.8em; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.3em; }
    .technique-content h2 { font-size: 1.5em; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.2em; }
    .technique-content h3 { font-size: 1.3em; }
    .technique-content h4 { font-size: 1.1em; }
    .technique-content h5 { font-size: 1.05em; }
    .technique-content h6 { font-size: 1em; }

    .technique-content p {
      margin: 1em 0;
    }

    .technique-content blockquote {
      border-left: 4px solid #60a5fa;
      padding-left: 1em;
      margin: 1em 0;
      color: #6b7280;
      background: #f8fafc;
      padding: 1em;
      border-radius: 0 8px 8px 0;
    }

    .technique-content ul,
    .technique-content ol {
      margin: 1em 0;
      padding-left: 2em;
    }

    .technique-content li {
      margin: 0.5em 0;
    }

    .technique-content code {
      background: #f3f4f6;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: #dc2626;
    }

    .technique-content pre {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 1em;
      overflow-x: auto;
      margin: 1em 0;
    }

    .technique-content pre code {
      background: none;
      padding: 0;
      border-radius: 0;
      color: inherit;
    }

    /* MarkdownË°®Ê†ºÊ†∑Âºè */
    .technique-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1em 0;
      background: #a5d8ff;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .technique-content th,
    .technique-content td {
      border: 1px solid #d1d5db;
      padding: 0.75em 1em;
      text-align: center;
      vertical-align: top;
    }

    .technique-content th {
      background: rgba(255, 255, 255, 0.95);
      font-weight: 600;
      color: #1f2937;
      border-bottom: 2px solid #9ca3af;
    }

    .technique-content tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.8);
    }

    .technique-content tr:hover {
      background: rgba(255, 255, 255, 0.9);
    }

    /* Âº∫Ë∞ÉÂíåÁ™ÅÂá∫ÊòæÁ§∫ */
    .technique-content strong,
    .technique-content b {
      font-weight: 700;
      color: #1f2937;
    }

    .technique-content em,
    .technique-content i {
      font-style: italic;
      color: #4b5563;
    }

    .technique-content del {
      text-decoration: line-through;
      color: #9ca3af;
    }

    .technique-content mark {
      background: #fef3c7;
      color: #92400e;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }

    /* ÈìæÊé•Ê†∑Âºè */
    .technique-content a {
      color: #60a5fa;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: all 0.2s;
    }

    .technique-content a:hover {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }

    /* Ê∞¥Âπ≥Á∫ø */
    .technique-content hr {
      border: none;
      height: 2px;
      background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
      margin: 2em 0;
    }

    /* ÂÖ®Â±èMarkdownÊ†∑Âºè */
    .fullscreen-content h1,
    .fullscreen-content h2,
    .fullscreen-content h3,
    .fullscreen-content h4,
    .fullscreen-content h5,
    .fullscreen-content h6 {
      color: #1f2937;
      margin-top: 1.5em;
      margin-bottom: 0.5em;
      font-weight: 600;
    }

    .fullscreen-content h1 { font-size: 1.8em; border-bottom: 3px solid #e5e7eb; padding-bottom: 0.3em; }
    .fullscreen-content h2 { font-size: 1.5em; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.2em; }
    .fullscreen-content h3 { font-size: 1.3em; }
    .fullscreen-content h4 { font-size: 1.1em; }
    .fullscreen-content h5 { font-size: 1.0em; }
    .fullscreen-content h6 { font-size: 0.95em; }

    .fullscreen-content p {
      margin: 1.2em 0;
      font-size: 1.0em;
      line-height: 1.8;
    }

    .fullscreen-content blockquote {
      border-left: 5px solid #60a5fa;
      padding-left: 1.5em;
      margin: 1.5em 0;
      color: #6b7280;
      background: #f8fafc;
      padding: 1.5em;
      border-radius: 0 12px 12px 0;
      font-style: italic;
      font-size: 1.1em;
    }

    .fullscreen-content ul,
    .fullscreen-content ol {
      margin: 1.2em 0;
      padding-left: 2.5em;
    }

    .fullscreen-content li {
      margin: 0.6em 0;
      font-size: 1.0em;
    }

    .fullscreen-content code {
      background: #f3f4f6;
      padding: 0.3em 0.6em;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 0.95em;
      color: #dc2626;
      border: 1px solid #e2e8f0;
    }

    .fullscreen-content pre {
      background: #f8fafc;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5em;
      overflow-x: auto;
      margin: 1.5em 0;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }

    .fullscreen-content pre code {
      background: none;
      padding: 0;
      border-radius: 0;
      color: inherit;
      border: none;
    }

    /* ÂÖ®Â±èË°®Ê†ºÊ†∑Âºè */
    .fullscreen-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5em 0;
      background: #a5d8ff;
      border: 3px solid #e5e7eb;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .fullscreen-content th,
    .fullscreen-content td {
      border: 2px solid #d1d5db;
      padding: 1em 1.2em;
      text-align: center;
      vertical-align: top;
    }

    .fullscreen-content th {
      background: rgba(255, 255, 255, 0.95);
      font-weight: 700;
      color: #1f2937;
      border-bottom: 3px solid #9ca3af;
      font-size: 1.0em;
    }

    .fullscreen-content tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.8);
    }

    .fullscreen-content tr:hover {
      background: rgba(255, 255, 255, 0.9);
      transform: scale(1.01);
      transition: all 0.2s;
    }

    /* ÂÖ®Â±èÂº∫Ë∞ÉÊ†∑Âºè */
    .fullscreen-content strong,
    .fullscreen-content b {
      font-weight: 700;
      color: #1f2937;
    }

    .fullscreen-content em,
    .fullscreen-content i {
      font-style: italic;
      color: #4b5563;
    }

    .fullscreen-content del {
      text-decoration: line-through;
      color: #9ca3af;
    }

    .fullscreen-content mark {
      background: #fef3c7;
      color: #92400e;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .fullscreen-content a {
      color: #60a5fa;
      text-decoration: none;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
      font-weight: 500;
    }

    .fullscreen-content a:hover {
      color: #3b82f6;
      border-bottom-color: #3b82f6;
    }

    .fullscreen-content hr {
      border: none;
      height: 3px;
      background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
      margin: 3em 0;
    }

    /* ÂÖ®Â±èÂ∏ÉÂ±ÄÊéßÂà∂ */
    .fullscreen-narrow {
      max-width: 600px;
      margin: 0 auto;
      font-size: 1.0em;
    }

    .fullscreen-wide {
      max-width: 1200px;
      margin: 0 auto;
      font-size: 1.0em;
    }

    /* ÂÖ®Â±èÁõÆÂΩïÊ†∑Âºè */
    .fullscreen-toc-float {
      position: fixed;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      z-index: 10;
      transition: all 0.3s ease;
    }

    .fullscreen-toc-float.collapsed {
      left: -20px;
      opacity: 0.9;
    }

    .fullscreen-toc.collapsed {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: rgba(96, 165, 250, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 4px 12px rgba(96, 165, 250, 0.2);
      border: 2px solid rgba(96, 165, 250, 0.4);
      transition: all 0.3s ease;
    }

    .fullscreen-toc.collapsed:hover {
      background: rgba(96, 165, 250, 0.3);
      box-shadow: 0 6px 20px rgba(96, 165, 250, 0.3);
      border-color: rgba(96, 165, 250, 0.6);
      transform: scale(1.05);
    }

    .fullscreen-toc.collapsed .fullscreen-toc-title,
    .fullscreen-toc.collapsed .toc-list {
      display: none;
    }

    .fullscreen-toc.collapsed::before {
      content: "üìñ";
      font-size: 22px;
      color: #1f2937;
      font-weight: bold;
    }

    .fullscreen-toc {
      width: 280px;
      background: rgba(248, 250, 252, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(226, 232, 240, 0.3);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      max-height: calc(100vh - 140px);
      overflow-y: auto;
      transition: all 0.3s ease;
    }

    .fullscreen-toc:hover {
      background: rgba(248, 250, 252, 0.9);
      border-color: rgba(96, 165, 250, 0.2);
      box-shadow: 0 4px 16px rgba(96, 165, 250, 0.08);
    }

    .fullscreen-toc-title {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .toc-toggle-btn {
      background: none;
      border: none;
      color: #6b7280;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      font-size: 16px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
    }

    .toc-toggle-btn:hover {
      background: #f3f4f6;
      color: #374151;
    }

    .toc-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .toc-item {
      margin-bottom: 8px;
    }

    .toc-link {
      display: block;
      color: #4b5563;
      text-decoration: none;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-size: 14px;
      line-height: 1.4;
      border-left: 3px solid transparent;
    }

    .toc-link:hover {
      background: #eff6ff;
      color: #3b82f6;
      border-left-color: #3b82f6;
      transform: translateX(2px);
    }

    .toc-link.active {
      background: rgba(96, 165, 250, 0.1);
      color: #3b82f6;
      border-left-color: #60a5fa;
      font-weight: 500;
      box-shadow: 0 1px 3px rgba(96, 165, 250, 0.1);
    }

    .toc-h1 { padding-left: 0; font-weight: 600; }
    .toc-h2 { padding-left: 12px; }
    .toc-h3 { padding-left: 24px; font-size: 13px; }
    .toc-h4 { padding-left: 36px; font-size: 13px; }
    .toc-h5 { padding-left: 48px; font-size: 12px; }
    .toc-h6 { padding-left: 60px; font-size: 12px; }

    .fullscreen-content-with-toc {
      flex: 1;
      min-width: 0;
    }

    /* ÊªöÂä®Êù°Ê†∑Âºè‰ºòÂåñ */
    .fullscreen-toc::-webkit-scrollbar {
      width: 4px;
    }

    .fullscreen-toc::-webkit-scrollbar-track {
      background: rgba(241, 245, 249, 0.5);
      border-radius: 2px;
    }

    .fullscreen-toc::-webkit-scrollbar-thumb {
      background: rgba(203, 213, 225, 0.6);
      border-radius: 2px;
    }

    .fullscreen-toc::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.8);
    }

    /* Â∏ÉÂ±ÄÂàáÊç¢ÊåâÈíÆ */
    .layout-toggle {
      display: flex;
      gap: 8px;
      margin-left: 16px;
    }

    .layout-btn {
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      color: #374151;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
    }

    .layout-btn:hover {
      background: #e5e7eb;
      transform: translateY(-1px);
    }

    .layout-btn.active {
      background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
      color: white;
      border-color: #60a5fa;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
    }

    /* ÂìçÂ∫îÂºèËÆæËÆ° */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
        margin: 0;
      }
      
      .header {
        text-align: center;
        margin-bottom: 20px;
      }
      
      .header h1 {
        font-size: 24px;
        margin-bottom: 8px;
      }
      
      .categories {
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
      }
      
      .category-tab {
        padding: 10px 16px;
        font-size: 14px;
        min-width: 80px;
      }
      
      .modules {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .module.techniques {
        grid-column: 1;
      }
      
      .module {
        padding: 16px;
        min-height: 200px;
      }
      
      .module-header {
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }
      
      .module-title {
        font-size: 16px;
      }
      
      .add-btn {
        font-size: 14px;
        padding: 10px 20px;
        width: 100%;
        max-width: 120px;
      }
      
      .item {
        padding: 12px;
      }
      
      .word-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .word-group-title {
        margin-right: 0;
      }

      .word-main {
        margin-right: 0;
      }
      
      .item-actions {
        justify-content: center;
        margin-left: 0;
        gap: 8px;
        flex-wrap: wrap;
      }
      
      .action-btn {
        flex: 1;
        min-width: 60px;
        font-size: 12px;
      }
      
      .synonyms {
        gap: 8px;
        line-height: 1.8;
      }
      
      .synonym {
        padding: 4px 8px;
        font-size: 14px;
      }
      
      .hypernym-chain {
        font-size: 14px;
        line-height: 1.6;
      }
      
      .technique-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .technique-toggle {
        align-self: flex-end;
      }
      
      .items {
        overflow-y: visible;
        overflow-x: hidden;
      }

      .word-with-definition {
        min-width: 100px;
        padding: 6px 8px;
        margin: 2px;
        font-size: 12px;
      }

      .word-text {
        font-size: 13px;
        margin-bottom: 2px;
      }

      .word-definition {
        font-size: 11px;
      }

      .synonyms {
        gap: 4px;
      }

      .hypernym-chain {
        gap: 8px;
      }
      
      /* Ê®°ÊÄÅÊ°ÜÁßªÂä®Á´ØÈÄÇÈÖç */
      .modal-content {
        width: 95vw;
        max-height: 90vh;
        padding: 20px;
        margin: 5vh auto;
      }
      
      .modal-header {
        font-size: 18px;
        text-align: center;
        margin-bottom: 20px;
      }
      
      .form-input, .form-textarea {
        font-size: 16px;
        padding: 12px;
      }
      
      .synonym-input-row {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 12px;
      }
      
      .remove-synonym {
        justify-self: center;
        width: 80px;
      }
      
      .add-synonym {
        font-size: 14px;
        padding: 12px;
      }
      
      .btn {
        padding: 14px 24px;
        font-size: 16px;
        width: 100%;
        margin-bottom: 8px;
      }
      
      .modal-actions {
        flex-direction: column;
        gap: 12px;
      }
      
      /* ÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÁßªÂä®Á´ØÈÄÇÈÖç */
      .fullscreen-header {
        padding: 16px 20px;
        flex-direction: column;
        gap: 12px;
        text-align: center;
      }

      .fullscreen-title {
        font-size: 20px;
      }

      .fullscreen-actions {
        order: -1;
        justify-content: center;
      }

      .fullscreen-main {
        padding: 20px;
        flex-direction: column;
        gap: 20px;
      }

      .fullscreen-toc-float {
        position: static;
        transform: none;
        left: auto;
        top: auto;
        z-index: auto;
        margin-bottom: 20px;
      }

      .fullscreen-toc-float.collapsed {
        left: auto;
        opacity: 1;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10;
      }

      .fullscreen-toc.collapsed {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(96, 165, 250, 0.25);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(96, 165, 250, 0.25);
        border: 2px solid rgba(96, 165, 250, 0.5);
      }

      .fullscreen-toc.collapsed:hover {
        background: rgba(96, 165, 250, 0.35);
        box-shadow: 0 6px 20px rgba(96, 165, 250, 0.35);
        border-color: rgba(96, 165, 250, 0.7);
        transform: scale(1.05);
      }

      .fullscreen-toc {
        width: 100%;
        max-height: 200px;
        background: rgba(248, 250, 252, 0.9);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(226, 232, 240, 0.4);
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      }

      .fullscreen-toc:hover {
        background: rgba(248, 250, 252, 0.95);
        border-color: rgba(96, 165, 250, 0.3);
        box-shadow: 0 4px 12px rgba(96, 165, 250, 0.1);
      }

      .fullscreen-content {
        padding: 0;
        font-size: 15px;
        line-height: 1.7;
      }

      .fullscreen-edit-area {
        padding: 20px;
      }

      .fullscreen-textarea {
        font-size: 16px;
        padding: 16px;
        min-height: 400px;
      }

      /* ÂÖ®Â±èËØçÊ±áÁßªÂä®Á´ØÈÄÇÈÖç */
      .fullscreen-content .word-with-definition {
        min-width: 100px;
        padding: 8px 12px;
        margin: 4px;
        font-size: 14px;
      }

      .fullscreen-content .word-text {
        font-size: 14px;
        margin-bottom: 4px;
      }

      .fullscreen-content .word-definition {
        font-size: 12px;
      }

      .fullscreen-content .hypernym-chain {
        gap: 8px;
        padding: 4px;
      }

      .fullscreen-content .hypernym-separator {
        font-size: 14px;
      }

      .fullscreen-content .hypernym-arrow {
        font-size: 16px;
        margin: 0 8px;
      }

      /* Â§çÂà∂ÊåâÈíÆÁßªÂä®Á´ØÈÄÇÈÖç */
      .copy-btn {
        top: 8px;
        right: 8px;
        padding: 6px 8px;
        font-size: 14px;
      }

      /* ÊéíÂ∫èÊåâÈíÆÁßªÂä®Á´ØÈÄÇÈÖç */
      .sort-btn {
        padding: 3px 4px;
        font-size: 11px;
        min-width: 24px;
        height: 24px;
      }

      /* ÂÖ®Â±èÊéíÂ∫èÊåâÈíÆÁßªÂä®Á´ØÈÄÇÈÖç */
      .fullscreen-sort-btn {
        padding: 3px 4px;
        font-size: 11px;
        min-width: 24px;
        height: 24px;
      }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 12px;
      }
      
      .header h1 {
        font-size: 22px;
      }
      
      .categories {
        gap: 6px;
      }
      
      .category-tab {
        padding: 8px 12px;
        font-size: 13px;
        min-width: 70px;
      }
      
      .module {
        padding: 12px;
      }
      
      .add-btn {
        font-size: 12px;
        padding: 8px 16px;
      }
      
      .synonym, .hypernym-word {
        font-size: 13px;
        padding: 3px 6px;
      }

      .word-with-definition {
        min-width: 80px;
        padding: 4px 6px;
        margin: 1px;
        font-size: 11px;
      }

      .word-text {
        font-size: 12px;
        margin-bottom: 1px;
      }

      .word-definition {
        font-size: 10px;
      }

      .synonyms {
        gap: 2px;
      }

      .hypernym-chain {
        gap: 4px;
      }

      .hypernym-separator {
        font-size: 12px;
      }

      .hypernym-arrow {
        font-size: 14px;
        margin: 0 4px;
      }

      /* ÂÖ®Â±èËØçÊ±á480px‰ª•‰∏ãÈÄÇÈÖç */
      .fullscreen-content .word-with-definition {
        min-width: 80px;
        padding: 6px 8px;
        margin: 2px;
        font-size: 12px;
      }

      .fullscreen-content .word-text {
        font-size: 12px;
        margin-bottom: 2px;
      }

      .fullscreen-content .word-definition {
        font-size: 10px;
      }

      .fullscreen-content .hypernym-chain {
        gap: 4px;
        padding: 2px;
      }

      .fullscreen-content .hypernym-separator {
        font-size: 12px;
      }

      .fullscreen-content .hypernym-arrow {
        font-size: 14px;
        margin: 0 4px;
      }

      /* 480px‰ª•‰∏ãÂ§çÂà∂ÊåâÈíÆÈÄÇÈÖç */
      .copy-btn {
        top: 6px;
        right: 6px;
        padding: 4px 6px;
        font-size: 12px;
      }

      /* 480px‰ª•‰∏ãÊéíÂ∫èÊåâÈíÆÈÄÇÈÖç */
      .sort-btn {
        padding: 2px 3px;
        font-size: 10px;
        min-width: 22px;
        height: 22px;
      }

      /* 480px‰ª•‰∏ãÂÖ®Â±èÊéíÂ∫èÊåâÈíÆÈÄÇÈÖç */
      .fullscreen-sort-btn {
        padding: 2px 3px;
        font-size: 10px;
        min-width: 22px;
        height: 22px;
      }
    }
    
    .item-actions {
      display: flex;
      gap: 6px;
      margin-left: auto;
      flex-shrink: 0;
    }
    
    .action-btn {
      background: #f8fafc;
      color: #475569;
      border: 1px solid #e2e8f0;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
      min-width: 50px;
      text-align: center;
    }
    
    .action-btn:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-1px);
    }
    
    .action-btn.delete {
      color: #dc2626;
      border-color: #fca5a5;
      background: #fef2f2;
    }
    
    .action-btn.delete:hover {
      background: #fee2e2;
      border-color: #dc2626;
      transform: translateY(-1px);
    }
    
    /* Â§çÂà∂ÊåâÈíÆÊ†∑Âºè */
    .copy-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #e2e8f0;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 16px;
      color: #475569;
      transition: all 0.2s ease;
      z-index: 10;
    }

    .copy-btn:hover {
      background: #cbd5e1;
      border-color: #94a3b8;
      transform: translateY(-1px);
    }

    .copy-btn:active {
      transform: translateY(0);
    }

    .copy-btn.copied {
      background: #10b981;
      border-color: #059669;
      color: white;
    }

    /* ÊéíÂ∫èÊåâÈíÆÊ†∑Âºè */
    .sort-controls {
      display: flex;
      gap: 2px;
      align-items: center;
      margin-left: 8px;
    }

    .sort-btn {
      background: transparent;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      padding: 4px 6px;
      cursor: pointer;
      font-size: 12px;
      color: #6b7280;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      line-height: 1;
    }

    .sort-btn:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
      color: #374151;
    }

    .sort-btn.active {
      background: #eff6ff;
      color: #3b82f6;
      border-color: #60a5fa;
      font-weight: 500;
    }

    .sort-btn.active:hover {
      background: #dbeafe;
      border-color: #60a5fa;
    }

    /* ÂÖ®Â±èÊéíÂ∫èÊåâÈíÆÊ†∑Âºè */
    .fullscreen-sort-btn {
      background: transparent;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      padding: 4px 6px;
      cursor: pointer;
      font-size: 12px;
      color: #6b7280;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 28px;
      height: 28px;
      line-height: 1;
    }

    .fullscreen-sort-btn:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
      color: #374151;
    }

    .fullscreen-sort-btn.active {
      background: #eff6ff;
      color: #3b82f6;
      border-color: #60a5fa;
      font-weight: 500;
    }

    .fullscreen-sort-btn.active:hover {
      background: #dbeafe;
      border-color: #60a5fa;
    }

    /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2500;
      backdrop-filter: blur(4px);
    }
    
    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 24px;
      width: min(600px, 90vw);
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .modal-header {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 16px;
      color: #1f2937;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #374151;
    }
    
    .form-input {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
      box-sizing: border-box;
      font-family: inherit;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .form-textarea {
      resize: none;
      min-height: 80px;
      font-family: inherit;
    }
    
    .synonym-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .synonym-input-row {
      display: grid;
      grid-template-columns: 1fr 2fr auto;
      gap: 12px;
      align-items: center;
      padding: 8px;
      background: #f8fafc;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .remove-synonym {
      background: #ef4444;
      color: white;
      border: none;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .add-synonym {
      background: #10b981;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-top: 8px;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 80px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, #60a5fa, #3b82f6);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    
    .btn-secondary {
      background: #f8fafc;
      color: #475569;
      border: 2px solid #e2e8f0;
    }
    
    .btn-secondary:hover {
      background: #f1f5f9;
      border-color: #cbd5e1;
      transform: translateY(-2px);
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f4f6;
      border-top: 2px solid #60a5fa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .audio-playing {
      color: #10b981 !important;
      transform: scale(1.05);
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 16px;
        border-radius: 16px;
      }
      
      .categories {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .modules {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .module {
        padding: 16px;
      }
      
      .modal-content {
        width: 95vw;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Â≠¶‰π†ÊäÄÂ∑ß</h1>
      <div style="display: flex; align-items: center; gap: 16px;">
        <div id="userDisplay"></div>
        <a href="/" class="back-btn">‚Üê ËøîÂõû‰∏ªÈ°µ</a>
      </div>
    </div>
    
    <div class="categories">
      <div class="category-tab active" data-category="listening">
        <span class="category-icon">üéß</span>
        <span class="category-name">Listening</span>
      </div>
      <div class="category-tab" data-category="speaking">
        <span class="category-icon">üé§</span>
        <span class="category-name">Speaking</span>
      </div>
      <div class="category-tab" data-category="reading">
        <span class="category-icon">üìñ</span>
        <span class="category-name">Reading</span>
      </div>
      <div class="category-tab" data-category="writing">
        <span class="category-icon">‚úçÔ∏è</span>
        <span class="category-name">Writing</span>
      </div>
    </div>
    
    <div id="content-listening" class="content-area active">
      <div class="modules">
        <div class="module">
          <div class="module-header">
            <div class="module-title">üìù ËØçÊ±áÊõøÊç¢</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('synonyms', 'listening', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('synonyms', 'listening', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenSynonyms('listening')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('synonym', 'listening')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openSynonymModal('listening')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="synonyms-listening"></div>
        </div>
        
        <div class="module">
          <div class="module-header">
            <div class="module-title">üîó ‰∏ä‰∏ã‰πâËØç</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('hypernyms', 'listening', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('hypernyms', 'listening', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenHypernyms('listening')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('hypernym', 'listening')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openHypernymModal('listening')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="hypernyms-listening"></div>
        </div>
        
        <div class="module techniques">
          <div class="module-header">
            <div class="module-title">üí° ÂÅöÈ¢òÊäÄÂ∑ß</div>
            <button class="add-btn" onclick="openTechniqueModal('listening')">Ê∑ªÂä†</button>
          </div>
          <div class="items" id="techniques-listening"></div>
        </div>
      </div>
    </div>
    
    <div id="content-speaking" class="content-area">
      <div class="modules">
        <div class="module">
          <div class="module-header">
            <div class="module-title">üìù ËØçÊ±áÊõøÊç¢</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('synonyms', 'speaking', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('synonyms', 'speaking', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenSynonyms('speaking')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('synonym', 'speaking')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openSynonymModal('speaking')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="synonyms-speaking"></div>
        </div>

        <div class="module">
          <div class="module-header">
            <div class="module-title">üîó ‰∏ä‰∏ã‰πâËØç</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('hypernyms', 'speaking', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('hypernyms', 'speaking', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenHypernyms('speaking')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('hypernym', 'speaking')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openHypernymModal('speaking')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="hypernyms-speaking"></div>
        </div>
        
        <div class="module techniques">
          <div class="module-header">
            <div class="module-title">üí° ÂÅöÈ¢òÊäÄÂ∑ß</div>
            <button class="add-btn" onclick="openTechniqueModal('speaking')">Ê∑ªÂä†</button>
          </div>
          <div class="items" id="techniques-speaking"></div>
        </div>
      </div>
    </div>
    
    <div id="content-reading" class="content-area">
      <div class="modules">
        <div class="module">
          <div class="module-header">
            <div class="module-title">üìù ËØçÊ±áÊõøÊç¢</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('synonyms', 'reading', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('synonyms', 'reading', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenSynonyms('reading')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('synonym', 'reading')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openSynonymModal('reading')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="synonyms-reading"></div>
        </div>

        <div class="module">
          <div class="module-header">
            <div class="module-title">üîó ‰∏ä‰∏ã‰πâËØç</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('hypernyms', 'reading', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('hypernyms', 'reading', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenHypernyms('reading')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('hypernym', 'reading')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openHypernymModal('reading')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="hypernyms-reading"></div>
        </div>
        
        <div class="module techniques">
          <div class="module-header">
            <div class="module-title">üí° ÂÅöÈ¢òÊäÄÂ∑ß</div>
            <button class="add-btn" onclick="openTechniqueModal('reading')">Ê∑ªÂä†</button>
          </div>
          <div class="items" id="techniques-reading"></div>
        </div>
      </div>
    </div>
    
    <div id="content-writing" class="content-area">
      <div class="modules">
        <div class="module">
          <div class="module-header">
            <div class="module-title">üìù ËØçÊ±áÊõøÊç¢</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('synonyms', 'writing', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('synonyms', 'writing', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenSynonyms('writing')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('synonym', 'writing')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openSynonymModal('writing')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="synonyms-writing"></div>
        </div>

        <div class="module">
          <div class="module-header">
            <div class="module-title">üîó ‰∏ä‰∏ã‰πâËØç</div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <div class="sort-controls">
                <button class="sort-btn active" onclick="sortItems('hypernyms', 'writing', 'desc')" title="ÊúÄÊñ∞Âú®Ââç">
                  ‚Üì
                </button>
                <button class="sort-btn" onclick="sortItems('hypernyms', 'writing', 'asc')" title="ÊúÄÊó©Âú®Ââç">
                  ‚Üë
                </button>
              </div>
              <button class="add-btn" onclick="openFullscreenHypernyms('writing')">ÂÖ®Â±è</button>
              <button class="add-btn" onclick="openFileUploadModal('hypernym', 'writing')">Áî®Êñá‰ª∂Ê∑ªÂä†</button>
              <button class="add-btn" onclick="openHypernymModal('writing')">Ê∑ªÂä†</button>
            </div>
          </div>
          <div class="items" id="hypernyms-writing"></div>
        </div>
        
        <div class="module techniques">
          <div class="module-header">
            <div class="module-title">üí° ÂÅöÈ¢òÊäÄÂ∑ß</div>
            <button class="add-btn" onclick="openTechniqueModal('writing')">Ê∑ªÂä†</button>
          </div>
          <div class="items" id="techniques-writing"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Âêå‰πâËØçÊ®°ÊÄÅÊ°Ü -->
  <div id="synonymModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Ê∑ªÂä†ËØçÊ±áÊõøÊç¢</div>
      <form id="synonymForm">
        <div class="form-group">
          <label class="form-label">ÁªÑÊ†áÈ¢òÔºàÂèØÈÄâÔºâ</label>
          <input type="text" id="synonymTitle" class="form-input" placeholder="ËØ∑ËæìÂÖ•ËØçÊ±áÁªÑÁöÑÊ†áÈ¢ò">
        </div>
        <div class="form-group">
          <label class="form-label">Âêå‰πâËØçÁªÑ</label>
          <div id="synonymInputs" class="synonym-inputs">
            <div class="synonym-input-row">
              <input type="text" placeholder="Âêå‰πâËØç" class="form-input synonym-word">
              <input type="text" placeholder="Èáä‰πâ" class="form-input synonym-def">
              <button type="button" class="remove-synonym" onclick="removeSynonymInput(this)">Âà†Èô§</button>
            </div>
          </div>
          <button type="button" class="add-synonym" onclick="addSynonymInput()">+ Ê∑ªÂä†Âêå‰πâËØç</button>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
          <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ‰∏ä‰∏ã‰πâËØçÊ®°ÊÄÅÊ°Ü -->
  <div id="hypernymModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Ê∑ªÂä†‰∏ä‰∏ã‰πâËØç</div>
      <form id="hypernymForm">
        <div class="form-group">
          <label class="form-label">ÁªÑÊ†áÈ¢òÔºàÂèØÈÄâÔºâ</label>
          <input type="text" id="hypernymTitle" class="form-input" placeholder="ËØ∑ËæìÂÖ•‰∏ä‰∏ã‰πâËØçÁªÑÁöÑÊ†áÈ¢ò">
        </div>
        <div class="form-group">
          <label class="form-label">‰∏ä‰πâËØç</label>
          <div id="hypernymUpperInputs" class="synonym-inputs">
            <div class="synonym-input-row">
              <input type="text" placeholder="‰∏ä‰πâËØç" class="form-input hypernym-word">
              <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
              <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'upper')">Âà†Èô§</button>
            </div>
          </div>
          <button type="button" class="add-synonym" onclick="addHypernymInput('upper')">+ Ê∑ªÂä†‰∏ä‰πâËØç</button>
        </div>
        <div class="form-group">
          <label class="form-label">‰∏ã‰πâËØç</label>
          <div id="hypernymLowerInputs" class="synonym-inputs">
            <div class="synonym-input-row">
              <input type="text" placeholder="‰∏ã‰πâËØç" class="form-input hypernym-word">
              <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
              <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'lower')">Âà†Èô§</button>
            </div>
          </div>
          <button type="button" class="add-synonym" onclick="addHypernymInput('lower')">+ Ê∑ªÂä†‰∏ã‰πâËØç</button>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
          <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- ÂÅöÈ¢òÊäÄÂ∑ßÊ®°ÊÄÅÊ°Ü -->
  <div id="techniqueModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Ê∑ªÂä†ÂÅöÈ¢òÊäÄÂ∑ß</div>
      <form id="techniqueForm">
        <div class="form-group">
          <label class="form-label">Ê†áÈ¢ò</label>
          <input type="text" id="techniqueTitle" class="form-input" placeholder="ËØ∑ËæìÂÖ•ÊäÄÂ∑ßÊ†áÈ¢ò" required>
        </div>
        <div class="form-group">
          <label class="form-label">ÂÜÖÂÆπÔºàÊîØÊåÅMarkdownËØ≠Ê≥ïÔºâ</label>
          <textarea id="techniqueContent" class="form-input form-textarea" placeholder="ËØ∑ËæìÂÖ•ÊäÄÂ∑ßÂÜÖÂÆπÔºåÊîØÊåÅMarkdownËØ≠Ê≥ïÂ¶Ç **Á≤ó‰Ωì** *Êñú‰Ωì* # Ê†áÈ¢ò - ÂàóË°®Á≠â" style="min-height: 150px;"></textarea>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
          <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Êñá‰ª∂‰∏ä‰º†Ê®°ÊÄÅÊ°Ü -->
  <div id="fileUploadModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Áî®Êñá‰ª∂Ê∑ªÂä†</div>
      <form id="fileUploadForm">
        <div class="form-group">
          <label class="form-label">ÈÄâÊã©JSONÊñá‰ª∂</label>
          <input type="file" id="jsonFile" class="form-input" accept=".json" required>
          <div style="margin-top: 8px; font-size: 14px; color: #6b7280;">
            ÊîØÊåÅ‰∏ä‰º†JSONÊ†ºÂºèÁöÑÊñá‰ª∂ÔºåÂåÖÂê´Â§öÁªÑËØçÊ±áÊï∞ÊçÆ
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">JSONÊ†ºÂºèËØ¥Êòé</label>
          <div style="position: relative;">
            <div id="jsonFormatExample" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-top: 8px; font-size: 14px; color: #374151; font-family: 'Courier New', monospace; white-space: pre-wrap; overflow-x: auto;"></div>
            <button id="copyJsonFormatBtn" class="copy-btn" title="Â§çÂà∂Ê†ºÂºèËØ¥Êòé" onclick="copyJsonFormat()">
              üìã
            </button>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
          <button type="submit" class="btn btn-primary">‰∏ä‰º†Âπ∂ÂØºÂÖ•</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentToken = null;
    let currentUser = null;
    let currentCategory = 'listening';
    
    // Ë∫´‰ªΩÈ™åËØÅÁõ∏ÂÖ≥
    function checkStoredToken(){
      const tk = localStorage.getItem('authToken');
      if(!tk) return Promise.resolve(false);
      return fetch('/verify_token',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({token:tk})})
        .then(r=>r.json()).then(d=>{ 
          if(d.valid){ 
            currentToken=tk; 
            const userStr = localStorage.getItem('currentUser');
            if(userStr) {
              try {
                currentUser = JSON.parse(userStr);
              } catch(e) {}
            }
            return true;
          } 
          localStorage.removeItem('authToken'); 
          localStorage.removeItem('currentUser');
          return false; 
        })
        .catch(()=>{ 
          localStorage.removeItem('authToken'); 
          localStorage.removeItem('currentUser');
          return false; 
        });
    }
    
    function redirectToLogin() {
      window.location.href = '/login';
    }
    
    function showUserInfo() {
      if(currentUser) {
        const userDisplay = document.getElementById('userDisplay');
        if(userDisplay) {
          userDisplay.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
              <img src="/static/${currentUser.avatar}" alt="${currentUser.display_name}" style="width: 24px; height: 24px; border-radius: 50%;">
              <span style="color: #374151; font-weight: 600;">${currentUser.display_name}</span>
            </div>
          `;
        }
      }
    }
    
    // ÂàÜÁ±ªÂàáÊç¢
    function switchCategory(category) {
      currentCategory = category;
      
      // Êõ¥Êñ∞ÂàÜÁ±ªÊ†áÁ≠æÁä∂ÊÄÅ
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-category="${category}"]`).classList.add('active');
      
      // Êõ¥Êñ∞ÂÜÖÂÆπÂå∫Âüü
      document.querySelectorAll('.content-area').forEach(area => {
        area.classList.remove('active');
      });
      document.getElementById(`content-${category}`).classList.add('active');
      
      // Âä†ËΩΩÊï∞ÊçÆ
      loadData(category);
    }
    
    // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
    function initEventListeners() {
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          switchCategory(tab.dataset.category);
        });
      });
    }
    
    // Âä†ËΩΩÊï∞ÊçÆ
    async function loadData(category) {
      console.log(`Ê≠£Âú®Âä†ËΩΩÊï∞ÊçÆ: ${category}`);

      try {
        const [synonyms, hypernyms, techniques] = await Promise.all([
          fetch(`/api/study_techniques/synonyms/${category}`, {
            headers: { 'Authorization': `Bearer ${currentToken}` }
          }).then(r => r.json()),
          fetch(`/api/study_techniques/hypernyms/${category}`, {
            headers: { 'Authorization': `Bearer ${currentToken}` }
          }).then(r => r.json()),
          fetch(`/api/study_techniques/techniques/${category}`, {
            headers: { 'Authorization': `Bearer ${currentToken}` }
          }).then(r => r.json())
        ]);

        console.log(`Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê:`, {
          synonyms: synonyms.length,
          hypernyms: hypernyms.length,
          techniques: techniques.length
        });

        // Â≠òÂÇ®Êï∞ÊçÆÂà∞ÂÖ®Â±ÄÂèòÈáè
        if (!currentData[category]) currentData[category] = {};
        currentData[category].synonyms = synonyms;
        currentData[category].hypernyms = hypernyms;
        currentData[category].techniques = techniques;

        renderSynonyms(category, synonyms);
        renderHypernyms(category, hypernyms);
        renderTechniques(category, techniques);

        console.log(`Êï∞ÊçÆÊ∏≤ÊüìÂÆåÊàê: ${category}`);
      } catch (error) {
        console.error('Failed to load data:', error);
      }
    }
    
    // Ê∏≤ÊüìÂêå‰πâËØç
    function renderSynonyms(category, data) {
      const container = document.getElementById(`synonyms-${category}`);
      container.innerHTML = '';

      if (data && data.length > 0) {
        data.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <div class="word-item">
              <div class="word-header">
                <div class="word-group-title" onclick="editTitle(this, '${category}', '${item.id}', 'synonym')" contenteditable="false">${item.title || 'Âêå‰πâËØçÁªÑ ' + (index + 1)}</div>
                <div class="item-actions">
                  <button class="action-btn" onclick="editSynonym('${category}', '${item.id}')">ÁºñËæë</button>
                  <button class="action-btn delete" onclick="deleteSynonym('${category}', '${item.id}')">Âà†Èô§</button>
                </div>
              </div>
              <div class="word-main">
                <div class="synonyms">
                  ${item.synonyms.map(syn =>
                    `<div class="word-with-definition">
                      <div class="word-text">${syn.word}</div>
                      ${syn.definition ? `<div class="word-definition">${syn.definition}</div>` : ''}
                    </div>`
                  ).join('')}
                </div>
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      } else {
        container.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 20px;">ÊöÇÊó†ËØçÊ±áÊõøÊç¢Êï∞ÊçÆ</div>';
      }
    }
    
    // Ê∏≤Êüì‰∏ä‰∏ã‰πâËØç
    function renderHypernyms(category, data) {
      const container = document.getElementById(`hypernyms-${category}`);
      container.innerHTML = '';

      if (data && data.length > 0) {
        data.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'item';

          let chainHtml = '<div class="hypernym-chain">';

          // Ê∏≤Êüì‰∏ä‰πâËØç
          if (item.upper_words && item.upper_words.length > 0) {
            item.upper_words.forEach((upper, index) => {
              if (index > 0) chainHtml += '<span class="hypernym-separator">, </span>';
              chainHtml += `<div class="word-with-definition">
                <div class="word-text">${upper.word}</div>
                ${upper.definition ? `<div class="word-definition">${upper.definition}</div>` : ''}
              </div>`;
            });
            chainHtml += '<span class="hypernym-arrow"> ‚Üí </span>';
          }

          // Ê∏≤Êüì‰∏ã‰πâËØç
          if (item.lower_words && item.lower_words.length > 0) {
            item.lower_words.forEach((lower, index) => {
              if (index > 0) chainHtml += '<span class="hypernym-separator">, </span>';
              chainHtml += `<div class="word-with-definition">
                <div class="word-text">${lower.word}</div>
                ${lower.definition ? `<div class="word-definition">${lower.definition}</div>` : ''}
              </div>`;
            });
          }

          chainHtml += '</div>';

          div.innerHTML = `
            <div class="word-item">
              <div class="word-header">
                <div class="word-group-title" onclick="editTitle(this, '${category}', '${item.id}', 'hypernym')" contenteditable="false">${item.title || '‰∏ä‰∏ã‰πâËØçÁªÑ ' + (index + 1)}</div>
                <div class="item-actions">
                  <button class="action-btn" onclick="editHypernym('${category}', '${item.id}')">ÁºñËæë</button>
                  <button class="action-btn delete" onclick="deleteHypernym('${category}', '${item.id}')">Âà†Èô§</button>
                </div>
              </div>
              <div class="word-main">
                ${chainHtml}
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      } else {
        container.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 20px;">ÊöÇÊó†‰∏ä‰∏ã‰πâËØçÊï∞ÊçÆ</div>';
      }
    }
    
    // Ê∏≤ÊüìÂÅöÈ¢òÊäÄÂ∑ß
    function renderTechniques(category, data) {
      const container = document.getElementById(`techniques-${category}`);
      container.innerHTML = '';

      if (data && data.length > 0) {
        data.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'item technique-item';
          const contentId = `technique-content-${category}-${index}`;
          div.innerHTML = `
            <div class="word-item">
              <div class="word-main">
                <div class="technique-header">
                  <div class="technique-title">${item.title}</div>
                  <button class="technique-toggle" onclick="toggleTechnique('${contentId}', this)">Â±ïÂºÄ ‚ñº</button>
                </div>
                <div class="technique-content" id="${contentId}">
                  ${renderMarkdown(item.content)}
                </div>
              </div>
              <div class="item-actions">
                <button class="action-btn" onclick="openFullscreenTechnique('${category}', '${item.id}')">ÂÖ®Â±è</button>
                <button class="action-btn" onclick="editTechnique('${category}', '${item.id}')">ÁºñËæë</button>
                <button class="action-btn delete" onclick="deleteTechnique('${category}', '${item.id}')">Âà†Èô§</button>
              </div>
            </div>
          `;
          container.appendChild(div);
        });
      } else {
        container.innerHTML = '<div style="text-align: center; color: #9ca3af; padding: 20px;">ÊöÇÊó†ÂÅöÈ¢òÊäÄÂ∑ßÊï∞ÊçÆ</div>';
      }
    }
    
    // ÁºñËæëÊ†áÈ¢ò
    function editTitle(element, category, id, type) {
      const originalText = element.textContent.trim();

      element.contentEditable = true;
      element.classList.add('editing');
      element.focus();

      // ÈÄâ‰∏≠ÂÖ®ÈÉ®ÊñáÊú¨
      const range = document.createRange();
      range.selectNodeContents(element);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);

      function saveTitle() {
        const newTitle = element.textContent.trim();
        if (newTitle && newTitle !== originalText) {
          updateTitle(category, id, type, newTitle);
        } else {
          element.textContent = originalText;
        }
        element.contentEditable = false;
        element.classList.remove('editing');
      }

      function cancelEdit() {
        element.textContent = originalText;
        element.contentEditable = false;
        element.classList.remove('editing');
      }

      element.onblur = saveTitle;
      element.onkeydown = function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          saveTitle();
        } else if (e.key === 'Escape') {
          e.preventDefault();
          cancelEdit();
        }
      };
    }

    // Êõ¥Êñ∞Ê†áÈ¢ò
    async function updateTitle(category, id, type, newTitle) {
      console.log('Updating title:', {category, id, type, newTitle});

      try {
        // ÊâæÂà∞ÂØπÂ∫îÁöÑitem
        let item;
        if (currentData[category]) {
          if (type === 'synonym') {
            item = currentData[category].synonyms.find(item => item.id === id);
          } else if (type === 'hypernym') {
            item = currentData[category].hypernyms.find(item => item.id === id);
          }
        }

        if (!item) {
          console.error('Item not found:', {category, id, type});
          return;
        }

        let url;
        if (type === 'synonym') {
          url = `/api/study_techniques/synonyms/${category}/${id}`;
        } else if (type === 'hypernym') {
          url = `/api/study_techniques/hypernyms/${category}/${id}`;
        }

        const requestData = {
          title: newTitle,
          // ‰øùÁïôÂéüÊúâÊï∞ÊçÆ
          ...(type === 'synonym' ? { synonyms: item.synonyms } : {
            upper_words: item.upper_words || [],
            lower_words: item.lower_words || []
          })
        };

        console.log('Sending request:', {url, data: requestData});

        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify(requestData)
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          const result = await response.json();
          console.log('Update successful:', result);

          // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
          if (currentData[category]) {
            if (type === 'synonym') {
              const item = currentData[category].synonyms.find(item => item.id === id);
              if (item) item.title = newTitle;
            } else if (type === 'hypernym') {
              const item = currentData[category].hypernyms.find(item => item.id === id);
              if (item) item.title = newTitle;
            }
          }
        } else {
          const errorText = await response.text();
          console.error('Failed to update title:', response.status, errorText);
          alert('Êõ¥Êñ∞Ê†áÈ¢òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (error) {
        console.error('Error updating title:', error);
        alert('Êõ¥Êñ∞Ê†áÈ¢òÊó∂ÂèëÁîüÈîôËØØÔºåËØ∑ÈáçËØï');
      }
    }

    // ÂàáÊç¢ÊäÄÂ∑ßÂÜÖÂÆπÊòæÁ§∫
    function toggleTechnique(contentId, button) {
      const content = document.getElementById(contentId);
      const isExpanded = content.classList.contains('expanded');

      if (isExpanded) {
        content.classList.remove('expanded');
        button.innerHTML = 'Â±ïÂºÄ ‚ñº';
      } else {
        content.classList.add('expanded');
        button.innerHTML = 'Êî∂Ëµ∑ ‚ñ≤';
      }
    }
    
    
    // Ê®°ÊÄÅÊ°ÜÊìç‰Ωú
    function openSynonymModal(category) {
      document.getElementById('synonymForm').reset();
      document.getElementById('synonymTitle').value = '';
      document.getElementById('synonymInputs').innerHTML = `
        <div class="synonym-input-row">
          <input type="text" placeholder="Âêå‰πâËØç" class="form-input synonym-word">
          <input type="text" placeholder="Èáä‰πâ" class="form-input synonym-def">
          <button type="button" class="remove-synonym" onclick="removeSynonymInput(this)">Âà†Èô§</button>
        </div>
      `;
      document.getElementById('synonymModal').classList.add('show');
    }
    
    function openHypernymModal(category) {
      document.getElementById('hypernymForm').reset();
      document.getElementById('hypernymTitle').value = '';

      // ÈáçÁΩÆ‰∏ä‰πâËØçËæìÂÖ•
      document.getElementById('hypernymUpperInputs').innerHTML = `
        <div class="synonym-input-row">
          <input type="text" placeholder="‰∏ä‰πâËØç" class="form-input hypernym-word">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'upper')">Âà†Èô§</button>
        </div>
      `;
      
      // ÈáçÁΩÆ‰∏ã‰πâËØçËæìÂÖ•
      document.getElementById('hypernymLowerInputs').innerHTML = `
        <div class="synonym-input-row">
          <input type="text" placeholder="‰∏ã‰πâËØç" class="form-input hypernym-word">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'lower')">Âà†Èô§</button>
        </div>
      `;
      
      document.getElementById('hypernymModal').classList.add('show');
    }
    
    function openTechniqueModal(category) {
      document.getElementById('techniqueForm').reset();
      document.getElementById('techniqueModal').classList.add('show');
    }
    
    function closeModal() {
      // ‰øùÂ≠òÁºñËæëÈ°π‰ø°ÊÅØÔºàÂ¶ÇÊûúÂ≠òÂú®ÔºâÔºåÂõ†‰∏∫ÂêéÈù¢ÁöÑÊìç‰Ωú‰ºöÂ∞ÜÂÖ∂ËÆæ‰∏∫null
      const wasFullscreenEdit = editingItem && editingItem.isFullscreen;
      const editType = editingItem ? editingItem.type : null;
      const editCategory = editingItem ? editingItem.category : null;

      document.querySelectorAll('.modal').forEach(modal => {
        modal.classList.remove('show');
      });

      // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÁöÑ
      if (wasFullscreenEdit) {
        // ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÔºåÈáçÊñ∞ÊâìÂºÄÂÖ®Â±èÊ®°ÊÄÅÊ°Ü
        if (editType === 'synonym') {
          openFullscreenSynonyms(editCategory);
        } else if (editType === 'hypernym') {
          openFullscreenHypernyms(editCategory);
        }
      }

      // ÈáçÁΩÆÁºñËæëÁä∂ÊÄÅÂíåÊ®°ÊÄÅÊ°ÜÊ†áÈ¢ò
      editingItem = null;
      currentUploadType = null;
      currentUploadCategory = null;
      document.querySelector('#synonymModal .modal-header').textContent = 'Ê∑ªÂä†ËØçÊ±áÊõøÊç¢';
      document.querySelector('#hypernymModal .modal-header').textContent = 'Ê∑ªÂä†‰∏ä‰∏ã‰πâËØç';
      document.querySelector('#techniqueModal .modal-header').textContent = 'Ê∑ªÂä†ÂÅöÈ¢òÊäÄÂ∑ß';

      // ÈáçÁΩÆÊñá‰ª∂‰∏ä‰º†Ë°®Âçï
      document.getElementById('fileUploadForm').reset();
    }

    // Â§çÂà∂ÂäüËÉΩ
    async function copyJsonFormat() {
      const formatExample = document.getElementById('jsonFormatExample');
      const copyBtn = document.getElementById('copyJsonFormatBtn');

      try {
        // Ëé∑ÂèñÁ∫ØÊñáÊú¨ÂÜÖÂÆπÔºàÂéªÈô§HTMLÊ†áÁ≠æÔºâ
        const textToCopy = formatExample.textContent || formatExample.innerText;

        await navigator.clipboard.writeText(textToCopy);

        // ËßÜËßâÂèçÈ¶à
        copyBtn.innerHTML = '‚úÖ';
        copyBtn.classList.add('copied');
        copyBtn.title = 'Â∑≤Â§çÂà∂ÔºÅ';

        // 3ÁßíÂêéÊÅ¢Â§çÂéüÁä∂
        setTimeout(() => {
          copyBtn.innerHTML = 'üìã';
          copyBtn.classList.remove('copied');
          copyBtn.title = 'Â§çÂà∂Ê†ºÂºèËØ¥Êòé';
        }, 3000);

      } catch (error) {
        console.error('Â§çÂà∂Â§±Ë¥•:', error);

        // ÈôçÁ∫ßÊñπÊ°àÔºö‰ΩøÁî®‰º†ÁªüÁöÑÊñπÊ≥ï
        try {
          const textArea = document.createElement('textarea');
          textArea.value = formatExample.textContent || formatExample.innerText;
          textArea.style.position = 'fixed';
          textArea.style.left = '-9999px';
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);

          copyBtn.innerHTML = '‚úÖ';
          copyBtn.classList.add('copied');
          copyBtn.title = 'Â∑≤Â§çÂà∂ÔºÅ';

          setTimeout(() => {
            copyBtn.innerHTML = 'üìã';
            copyBtn.classList.remove('copied');
            copyBtn.title = 'Â§çÂà∂Ê†ºÂºèËØ¥Êòé';
          }, 3000);

        } catch (fallbackError) {
          console.error('ÈôçÁ∫ßÂ§çÂà∂‰πüÂ§±Ë¥•:', fallbackError);
          alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÊã©ÊñáÊú¨Â§çÂà∂');
        }
      }
    }

    // ÊéíÂ∫èÂäüËÉΩ
    function sortItems(type, category, order) {
      const containerId = `${type}-${category}`;
      const container = document.getElementById(containerId);

      if (!container) return;

      // Êõ¥Êñ∞ÊéíÂ∫èÊåâÈíÆÁä∂ÊÄÅ
      const sortControls = container.closest('.module').querySelector('.sort-controls');
      if (sortControls) {
        sortControls.querySelectorAll('.sort-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
      }

      // Ëé∑ÂèñÊï∞ÊçÆÂπ∂ÊéíÂ∫è
      const data = currentData[category]?.[type] || [];

      if (data.length === 0) return;

      // ÊåâÂàõÂª∫Êó∂Èó¥ÊéíÂ∫è
      const sortedData = [...data].sort((a, b) => {
        const dateA = new Date(a.created_at);
        const dateB = new Date(b.created_at);

        if (order === 'asc') {
          return dateA - dateB; // ÊúÄÊó©ÁöÑÂú®Ââç
        } else {
          return dateB - dateA; // ÊúÄÊñ∞ÁöÑÂú®Ââç
        }
      });

      // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
      if (!currentData[category]) currentData[category] = {};
      currentData[category][type] = sortedData;

      // ÈáçÊñ∞Ê∏≤Êüì
      if (type === 'synonyms') {
        renderSynonyms(category, sortedData);
      } else if (type === 'hypernyms') {
        renderHypernyms(category, sortedData);
      }
    }

    // Êñá‰ª∂‰∏ä‰º†Áõ∏ÂÖ≥ÂáΩÊï∞
    function openFileUploadModal(type, category) {
      currentUploadType = type;
      currentUploadCategory = category;

      // ËÆæÁΩÆÊ†ºÂºèËØ¥Êòé
      const formatExample = document.getElementById('jsonFormatExample');
      if (type === 'synonym') {
        formatExample.innerHTML = `ËØçÊ±áÊõøÊç¢JSONÊ†ºÂºèÁ§∫‰æãÔºö
{
  "groups": [
    {
      "title": "ÊèèËø∞Â§ñË≤åÁöÑËØçÊ±á",
      "synonyms": [
        {"word": "beautiful", "definition": "Áæé‰∏ΩÁöÑ"},
        {"word": "attractive", "definition": "ÊúâÂê∏ÂºïÂäõÁöÑ"},
        {"word": "gorgeous", "definition": "Âçé‰∏ΩÁöÑ"}
      ]
    },
    {
      "title": "Ë°®ËææÂñúÊ¨¢ÁöÑËØçÊ±á",
      "synonyms": [
        {"word": "like", "definition": "ÂñúÊ¨¢"},
        {"word": "enjoy", "definition": "‰∫´Âèó"},
        {"word": "love", "definition": "ÁÉ≠Áà±"}
      ]
    }
  ]
}`;
      } else if (type === 'hypernym') {
        formatExample.innerHTML = `‰∏ä‰∏ã‰πâËØçJSONÊ†ºÂºèÁ§∫‰æãÔºö
{
  "groups": [
    {
      "title": "‰∫§ÈÄöÂ∑•ÂÖ∑",
      "upper_words": [
        {"word": "transportation", "definition": "ËøêËæì"}
      ],
      "lower_words": [
        {"word": "car", "definition": "Ê±ΩËΩ¶"},
        {"word": "bus", "definition": "ÂÖ¨ÂÖ±Ê±ΩËΩ¶"},
        {"word": "train", "definition": "ÁÅ´ËΩ¶"}
      ]
    },
    {
      "title": "È¢úËâ≤",
      "upper_words": [
        {"word": "color", "definition": "È¢úËâ≤"}
      ],
      "lower_words": [
        {"word": "red", "definition": "Á∫¢Ëâ≤"},
        {"word": "blue", "definition": "ËìùËâ≤"},
        {"word": "green", "definition": "ÁªøËâ≤"}
      ]
    }
  ]
}`;
      }

      document.getElementById('fileUploadModal').classList.add('show');
    }

    async function handleFileUpload(event) {
      event.preventDefault();

      const fileInput = document.getElementById('jsonFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('ËØ∑ÈÄâÊã©Ë¶Å‰∏ä‰º†ÁöÑÊñá‰ª∂');
        return;
      }

      // Ê£ÄÊü•Êñá‰ª∂Á±ªÂûã
      if (!file.name.toLowerCase().endsWith('.json')) {
        alert('Âè™ÊîØÊåÅ‰∏ä‰º†JSONÊ†ºÂºèÁöÑÊñá‰ª∂');
        return;
      }

      try {
        const text = await file.text();
        const data = JSON.parse(text);

        // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
        if (!data.groups || !Array.isArray(data.groups)) {
          alert('JSONÊ†ºÂºèÈîôËØØÔºöÁº∫Â∞ëgroupsÊï∞ÁªÑÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ');
          return;
        }

        // È™åËØÅÊØèÁªÑÊï∞ÊçÆÁöÑÊ†ºÂºè
        for (let i = 0; i < data.groups.length; i++) {
          const group = data.groups[i];

          if (currentUploadType === 'synonym') {
            if (!group.synonyms || !Array.isArray(group.synonyms)) {
              alert(`Á¨¨${i + 1}ÁªÑÊï∞ÊçÆÊ†ºÂºèÈîôËØØÔºöËØçÊ±áÊõøÊç¢ÈúÄË¶ÅÂåÖÂê´synonymsÊï∞ÁªÑ`);
              return;
            }
          } else if (currentUploadType === 'hypernym') {
            if ((!group.upper_words || !Array.isArray(group.upper_words)) &&
                (!group.lower_words || !Array.isArray(group.lower_words))) {
              alert(`Á¨¨${i + 1}ÁªÑÊï∞ÊçÆÊ†ºÂºèÈîôËØØÔºö‰∏ä‰∏ã‰πâËØçÈúÄË¶ÅÂåÖÂê´upper_wordsÊàñlower_wordsÊï∞ÁªÑ`);
              return;
            }
          }
        }

        // ÂºÄÂßã‰∏ä‰º†Êï∞ÊçÆ
        await uploadDataInBatches(data.groups);

      } catch (error) {
        console.error('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•:', error);
        alert('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•JSONÊ†ºÂºèÊòØÂê¶Ê≠£Á°Æ');
      }
    }

    async function uploadDataInBatches(groups) {
      let successCount = 0;
      let errorCount = 0;

      for (let i = 0; i < groups.length; i++) {
        const group = groups[i];

        try {
          let url;
          let requestData;

          if (currentUploadType === 'synonym') {
            url = `/api/study_techniques/synonyms/${currentUploadCategory}`;
            requestData = {
              title: group.title || `ËØçÊ±áÁªÑ ${i + 1}`,
              synonyms: group.synonyms
            };
          } else if (currentUploadType === 'hypernym') {
            url = `/api/study_techniques/hypernyms/${currentUploadCategory}`;
            requestData = {
              title: group.title || `‰∏ä‰∏ã‰πâËØçÁªÑ ${i + 1}`,
              upper_words: group.upper_words || [],
              lower_words: group.lower_words || []
            };
          }

          console.log(`Ê≠£Âú®‰∏ä‰º†Á¨¨${i + 1}ÁªÑÊï∞ÊçÆ:`, requestData);

          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${currentToken}`
            },
            body: JSON.stringify(requestData)
          });

          console.log(`Á¨¨${i + 1}ÁªÑÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

          if (response.ok) {
            const result = await response.json();
            console.log(`Á¨¨${i + 1}ÁªÑ‰∏ä‰º†ÊàêÂäü:`, result);
            successCount++;
          } else {
            const errorText = await response.text();
            console.error(`‰∏ä‰º†Á¨¨${i + 1}ÁªÑÂ§±Ë¥•:`, response.status, errorText);
            errorCount++;
          }

        } catch (error) {
          errorCount++;
          console.error(`‰∏ä‰º†Á¨¨${i + 1}ÁªÑÊó∂ÂèëÁîüÈîôËØØ:`, error);
        }
      }

      // ÊòæÁ§∫ÁªìÊûú
      if (errorCount === 0) {
        alert(`ÊàêÂäü‰∏ä‰º† ${successCount} ÁªÑÊï∞ÊçÆ`);
      } else {
        alert(`‰∏ä‰º†ÂÆåÊàêÔºöÊàêÂäü ${successCount} ÁªÑÔºåÂ§±Ë¥• ${errorCount} ÁªÑ„ÄÇËØ∑Ê£ÄÊü•ÊéßÂà∂Âè∞‰∫ÜËß£ËØ¶ÁªÜÈîôËØØ‰ø°ÊÅØ„ÄÇ`);
      }

      // Âà∑Êñ∞Êï∞ÊçÆ
      loadData(currentUploadCategory);
      closeModal();
    }
    
    // ÂÖ®Â±èÂäüËÉΩ
    function openFullscreenSynonyms(category) {
      const data = currentData[category]?.synonyms || [];
      if (data.length === 0) {
        alert('ÊöÇÊó†ËØçÊ±áÊõøÊç¢Êï∞ÊçÆ');
        return;
      }

      // ËÆæÁΩÆÂÖ®Â±èÊéíÂ∫èÁä∂ÊÄÅ
      fullscreenType = 'synonyms';
      fullscreenCategory = category;

      // ÊòæÁ§∫ÊéíÂ∫èÊéß‰ª∂
      const sortControls = document.getElementById('fullscreenSortControls');
      sortControls.style.display = 'flex';

      // ÈáçÁΩÆÊéíÂ∫èÊåâÈíÆÁä∂ÊÄÅ
      sortControls.querySelectorAll('.fullscreen-sort-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      sortControls.querySelector('[onclick*="desc"]').classList.add('active');

      let contentHtml = '<div style="display: flex; flex-direction: column; gap: 16px;">';

      data.forEach(item => {
        contentHtml += '<div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: white;">';
        contentHtml += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        contentHtml += `<h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${item.title || 'Êú™ÂëΩÂêç'}</h3>`;
        contentHtml += '<div style="display: flex; gap: 8px;">';
        contentHtml += `<button class="action-btn" onclick="editFullscreenSynonym('${category}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">ÁºñËæë</button>`;
        contentHtml += `<button class="action-btn delete" onclick="deleteFullscreenSynonym('${category}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">Âà†Èô§</button>`;
        contentHtml += '</div>';
        contentHtml += '</div>';
        contentHtml += '<div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start;">';

        item.synonyms.forEach(syn => {
          contentHtml += `
            <div class="word-with-definition">
              <div class="word-text">${syn.word}</div>
              ${syn.definition ? `<div class="word-definition">${syn.definition}</div>` : ''}
            </div>
          `;
        });

        contentHtml += '</div></div>';
      });

      contentHtml += '</div>';

      document.getElementById('fullscreenTitle').textContent = `${getCategoryName(category)} - ËØçÊ±áÊõøÊç¢`;
      document.getElementById('fullscreenContent').innerHTML = contentHtml;

      // ÈöêËóèÁºñËæëÂäüËÉΩ
      document.getElementById('fullscreenEditBtn').style.display = 'none';
      document.getElementById('fullscreenSaveBtn').style.display = 'none';

      document.getElementById('fullscreenModal').classList.add('show');
    }

    function openFullscreenHypernyms(category) {
      const data = currentData[category]?.hypernyms || [];
      if (data.length === 0) {
        alert('ÊöÇÊó†‰∏ä‰∏ã‰πâËØçÊï∞ÊçÆ');
        return;
      }

      // ËÆæÁΩÆÂÖ®Â±èÊéíÂ∫èÁä∂ÊÄÅ
      fullscreenType = 'hypernyms';
      fullscreenCategory = category;

      // ÊòæÁ§∫ÊéíÂ∫èÊéß‰ª∂
      const sortControls = document.getElementById('fullscreenSortControls');
      sortControls.style.display = 'flex';

      // ÈáçÁΩÆÊéíÂ∫èÊåâÈíÆÁä∂ÊÄÅ
      sortControls.querySelectorAll('.fullscreen-sort-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      sortControls.querySelector('[onclick*="desc"]').classList.add('active');

      let contentHtml = '<div style="display: flex; flex-direction: column; gap: 16px;">';

      data.forEach(item => {
        contentHtml += '<div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: white;">';
        contentHtml += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        contentHtml += `<h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${item.title || 'Êú™ÂëΩÂêç'}</h3>`;
        contentHtml += '<div style="display: flex; gap: 8px;">';
        contentHtml += `<button class="action-btn" onclick="editFullscreenHypernym('${category}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">ÁºñËæë</button>`;
        contentHtml += `<button class="action-btn delete" onclick="deleteFullscreenHypernym('${category}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">Âà†Èô§</button>`;
        contentHtml += '</div>';
        contentHtml += '</div>';
        contentHtml += '<div class="hypernym-chain">';

        // Ê∏≤Êüì‰∏ä‰πâËØç
        if (item.upper_words && item.upper_words.length > 0) {
          item.upper_words.forEach((upper, index) => {
            if (index > 0) contentHtml += '<span class="hypernym-separator">, </span>';
            contentHtml += `
              <div class="word-with-definition">
                <div class="word-text">${upper.word}</div>
                ${upper.definition ? `<div class="word-definition">${upper.definition}</div>` : ''}
              </div>
            `;
          });
          contentHtml += '<span class="hypernym-arrow"> ‚Üí </span>';
        }

        // Ê∏≤Êüì‰∏ã‰πâËØç
        if (item.lower_words && item.lower_words.length > 0) {
          item.lower_words.forEach((lower, index) => {
            if (index > 0) contentHtml += '<span class="hypernym-separator">, </span>';
            contentHtml += `
              <div class="word-with-definition">
                <div class="word-text">${lower.word}</div>
                ${lower.definition ? `<div class="word-definition">${lower.definition}</div>` : ''}
              </div>
            `;
          });
        }

        contentHtml += '</div></div>';
      });

      contentHtml += '</div>';

      document.getElementById('fullscreenTitle').textContent = `${getCategoryName(category)} - ‰∏ä‰∏ã‰πâËØç`;
      document.getElementById('fullscreenContent').innerHTML = contentHtml;

      // ÈöêËóèÁºñËæëÂäüËÉΩ
      document.getElementById('fullscreenEditBtn').style.display = 'none';
      document.getElementById('fullscreenSaveBtn').style.display = 'none';

      document.getElementById('fullscreenModal').classList.add('show');
    }

    function getCategoryName(category) {
      const names = {
        'listening': 'Listening',
        'speaking': 'Speaking',
        'reading': 'Reading',
        'writing': 'Writing'
      };
      return names[category] || category;
    }

    function openFullscreenTechnique(category, id) {
      const data = currentData[category]?.techniques || [];
      const item = data.find(item => item.id === id);
      if (!item) return;

      fullscreenTechnique = {category, id, item};
      document.getElementById('fullscreenTitle').textContent = item.title;

      // Ê∏≤ÊüìMarkdownÂÜÖÂÆπÂπ∂ÁîüÊàêÁõÆÂΩï
      const renderedContent = renderMarkdown(item.content);
      document.getElementById('fullscreenContent').innerHTML = renderedContent;
      document.getElementById('fullscreenTextarea').value = item.content;

      // ÁîüÊàêÂπ∂ÊòæÁ§∫ÁõÆÂΩï
      generateTableOfContents(item.content);

      // Â∫îÁî®Áî®Êà∑ÂÅèÂ•ΩÁöÑÂ∏ÉÂ±Ä
      loadFullscreenLayoutPreference();

      // ÊòæÁ§∫Â∏ÉÂ±ÄÂàáÊç¢Êéß‰ª∂
      document.getElementById('layoutToggle').style.display = 'flex';

      // ÈáçÁΩÆÂà∞Êü•ÁúãÊ®°Âºè
      document.getElementById('fullscreenContent').style.display = 'block';
      document.getElementById('fullscreenEditArea').classList.remove('active');
      document.getElementById('fullscreenEditBtn').style.display = 'inline-block';
      document.getElementById('fullscreenSaveBtn').style.display = 'none';

      document.getElementById('fullscreenModal').classList.add('show');
    }
    
    function closeFullscreenModal() {
      document.getElementById('fullscreenModal').classList.remove('show');
      fullscreenTechnique = null;

      // ÈöêËóèÊéíÂ∫èÊéß‰ª∂
      const sortControls = document.getElementById('fullscreenSortControls');
      sortControls.style.display = 'none';

      // ÈöêËóèÂ∏ÉÂ±ÄÂàáÊç¢Êéß‰ª∂
      const layoutToggle = document.getElementById('layoutToggle');
      layoutToggle.style.display = 'none';

      // ÈöêËóèÁõÆÂΩï
      const tocFloat = document.getElementById('fullscreenTocFloat');
      tocFloat.style.display = 'none';

      // Ê∏ÖÁêÜÁõÆÂΩïÁõ∏ÂÖ≥‰∫ã‰ª∂ÁõëÂê¨Âô®
      const tocContainer = document.getElementById('tocList');
      const tocWrapper = document.getElementById('fullscreenToc');
      const contentContainer = document.querySelector('.fullscreen-modal');
      tocContainer.removeEventListener('click', handleTocClick);
      if (tocWrapper._handleTocInteraction) {
        tocWrapper.removeEventListener('click', tocWrapper._handleTocInteraction);
        delete tocWrapper._handleTocInteraction;
      }
      contentContainer.removeEventListener('scroll', updateActiveTocItem);

      // Ê∏ÖÁ©∫ÁõÆÂΩïÂÜÖÂÆπ
      tocContainer.innerHTML = '';

      // ÈáçÁΩÆÂÖ®Â±èÁä∂ÊÄÅ
      fullscreenType = null;
      fullscreenCategory = null;
    }

    // ÂÖ®Â±èÊéíÂ∫èÂäüËÉΩ
    function sortFullscreenItems(order) {
      if (!fullscreenType || !fullscreenCategory) return;

      const data = currentData[fullscreenCategory]?.[fullscreenType] || [];
      if (data.length === 0) return;

      // Êõ¥Êñ∞ÊéíÂ∫èÊåâÈíÆÁä∂ÊÄÅ
      const sortControls = document.getElementById('fullscreenSortControls');
      sortControls.querySelectorAll('.fullscreen-sort-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // ÊåâÂàõÂª∫Êó∂Èó¥ÊéíÂ∫è
      const sortedData = [...data].sort((a, b) => {
        const dateA = new Date(a.created_at);
        const dateB = new Date(b.created_at);

        if (order === 'asc') {
          return dateA - dateB; // ÊúÄÊó©ÁöÑÂú®Ââç
        } else {
          return dateB - dateA; // ÊúÄÊñ∞ÁöÑÂú®Ââç
        }
      });

      // ÈáçÊñ∞Ê∏≤ÊüìÂÖ®Â±èÂÜÖÂÆπ
      if (fullscreenType === 'synonyms') {
        renderFullscreenSynonyms(sortedData);
      } else if (fullscreenType === 'hypernyms') {
        renderFullscreenHypernyms(sortedData);
      }
    }

    // Ê∏≤ÊüìÂÖ®Â±èËØçÊ±áÊõøÊç¢
    function renderFullscreenSynonyms(data) {
      let contentHtml = '<div style="display: flex; flex-direction: column; gap: 16px;">';

      data.forEach(item => {
        contentHtml += '<div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: white;">';
        contentHtml += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        contentHtml += `<h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${item.title || 'Êú™ÂëΩÂêç'}</h3>`;
        contentHtml += `<button class="action-btn delete" onclick="deleteFullscreenSynonym('${fullscreenCategory}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">Âà†Èô§</button>`;
        contentHtml += '</div>';
        contentHtml += '<div style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start;">';

        item.synonyms.forEach(syn => {
          contentHtml += `
            <div class="word-with-definition">
              <div class="word-text">${syn.word}</div>
              ${syn.definition ? `<div class="word-definition">${syn.definition}</div>` : ''}
            </div>
          `;
        });

        contentHtml += '</div></div>';
      });

      contentHtml += '</div>';
      document.getElementById('fullscreenContent').innerHTML = contentHtml;
    }

    // Ê∏≤ÊüìÂÖ®Â±è‰∏ä‰∏ã‰πâËØç
    function renderFullscreenHypernyms(data) {
      let contentHtml = '<div style="display: flex; flex-direction: column; gap: 16px;">';

      data.forEach(item => {
        contentHtml += '<div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: white;">';
        contentHtml += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">';
        contentHtml += `<h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">${item.title || 'Êú™ÂëΩÂêç'}</h3>`;
        contentHtml += '<div style="display: flex; gap: 8px;">';
        contentHtml += `<button class="action-btn" onclick="editFullscreenHypernym('${fullscreenCategory}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">ÁºñËæë</button>`;
        contentHtml += `<button class="action-btn delete" onclick="deleteFullscreenHypernym('${fullscreenCategory}', '${item.id}')" style="font-size: 12px; padding: 4px 8px;">Âà†Èô§</button>`;
        contentHtml += '</div>';
        contentHtml += '</div>';
        contentHtml += '<div class="hypernym-chain">';

        // Ê∏≤Êüì‰∏ä‰πâËØç
        if (item.upper_words && item.upper_words.length > 0) {
          item.upper_words.forEach((upper, index) => {
            if (index > 0) contentHtml += '<span class="hypernym-separator">, </span>';
            contentHtml += `
              <div class="word-with-definition">
                <div class="word-text">${upper.word}</div>
                ${upper.definition ? `<div class="word-definition">${upper.definition}</div>` : ''}
              </div>
            `;
          });
          contentHtml += '<span class="hypernym-arrow"> ‚Üí </span>';
        }

        // Ê∏≤Êüì‰∏ã‰πâËØç
        if (item.lower_words && item.lower_words.length > 0) {
          item.lower_words.forEach((lower, index) => {
            if (index > 0) contentHtml += '<span class="hypernym-separator">, </span>';
            contentHtml += `
              <div class="word-with-definition">
                <div class="word-text">${lower.word}</div>
                ${lower.definition ? `<div class="word-definition">${lower.definition}</div>` : ''}
              </div>
            `;
          });
        }

        contentHtml += '</div></div>';
      });

      contentHtml += '</div>';
      document.getElementById('fullscreenContent').innerHTML = contentHtml;
    }
    
    function enterFullscreenEditMode() {
      document.getElementById('fullscreenContent').style.display = 'none';
      document.getElementById('fullscreenTocFloat').style.display = 'none'; // ÁºñËæëÊó∂ÈöêËóèÁõÆÂΩï
      document.getElementById('fullscreenEditArea').classList.add('active');
      document.getElementById('fullscreenEditBtn').style.display = 'none';
      document.getElementById('fullscreenSaveBtn').style.display = 'inline-block';
    }
    
    async function saveFullscreenEdit() {
      if (!fullscreenTechnique) return;

      const newContent = document.getElementById('fullscreenTextarea').value;

      try {
        const response = await fetch(`/api/study_techniques/techniques/${fullscreenTechnique.category}/${fullscreenTechnique.id}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify({
            title: fullscreenTechnique.item.title,
            content: newContent
          })
        });

        if (response.ok) {
          // Êõ¥Êñ∞ÊòæÁ§∫
          const renderedContent = renderMarkdown(newContent);
          document.getElementById('fullscreenContent').innerHTML = renderedContent;
          fullscreenTechnique.item.content = newContent;

          // ÈáçÊñ∞ÁîüÊàêÁõÆÂΩï
          generateTableOfContents(newContent);

          // ÈÄÄÂá∫ÁºñËæëÊ®°Âºè
          document.getElementById('fullscreenContent').style.display = 'block';
          document.getElementById('fullscreenEditArea').classList.remove('active');
          document.getElementById('fullscreenEditBtn').style.display = 'inline-block';
          document.getElementById('fullscreenSaveBtn').style.display = 'none';

          // Âà∑Êñ∞ÂàóË°®Êï∞ÊçÆ
          loadData(fullscreenTechnique.category);
        } else {
          alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (error) {
        console.error('Save failed:', error);
        alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      }
    }
    
    function addSynonymInput() {
      const container = document.getElementById('synonymInputs');
      const div = document.createElement('div');
      div.className = 'synonym-input-row';
      div.innerHTML = `
        <input type="text" placeholder="Âêå‰πâËØç" class="form-input synonym-word">
        <input type="text" placeholder="Èáä‰πâ" class="form-input synonym-def">
        <button type="button" class="remove-synonym" onclick="removeSynonymInput(this)">Âà†Èô§</button>
      `;
      container.appendChild(div);
    }
    
    function removeSynonymInput(button) {
      const container = document.getElementById('synonymInputs');
      if (container.children.length > 1) {
        button.parentElement.remove();
      }
    }
    
    function addHypernymInput(type) {
      const container = document.getElementById(`hypernym${type === 'upper' ? 'Upper' : 'Lower'}Inputs`);
      const div = document.createElement('div');
      div.className = 'synonym-input-row';
      div.innerHTML = `
        <input type="text" placeholder="${type === 'upper' ? '‰∏ä‰πâËØç' : '‰∏ã‰πâËØç'}" class="form-input hypernym-word">
        <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
        <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, '${type}')">Âà†Èô§</button>
      `;
      container.appendChild(div);
    }
    
    function removeHypernymInput(button, type) {
      const container = document.getElementById(`hypernym${type === 'upper' ? 'Upper' : 'Lower'}Inputs`);
      if (container.children.length > 1) {
        button.parentElement.remove();
      }
    }
    
    // Ë°®ÂçïÊèê‰∫§
    async function submitSynonym() {
      const synonyms = [];
      document.querySelectorAll('#synonymInputs .synonym-input-row').forEach(row => {
        const wordInput = row.querySelector('.synonym-word');
        const defInput = row.querySelector('.synonym-def');
        if (wordInput && wordInput.value.trim()) {
          synonyms.push({
            word: wordInput.value.trim(),
            definition: defInput ? defInput.value.trim() : ''
          });
        }
      });

      if (synonyms.length === 0) {
        alert('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™Âêå‰πâËØç');
        return;
      }

      const title = document.getElementById('synonymTitle').value.trim();
      console.log('Submitting synonym:', {synonyms, title, currentToken: currentToken ? 'exists' : 'null'});

      try {
        let url = `/api/study_techniques/synonyms/${currentCategory}`;
        let method = 'POST';

        // Â¶ÇÊûúÊòØÁºñËæëÊ®°Âºè
        if (editingItem && editingItem.type === 'synonym') {
          url += `/${editingItem.id}`;
          method = 'PUT';
        }

        const requestData = {
          synonyms,
          ...(title ? {title} : {})
        };

        console.log('Sending request:', {url, method, data: requestData});

        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify(requestData)
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          const result = await response.json();
          console.log('Submit successful:', result);

          // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÁöÑ
          if (editingItem && editingItem.isFullscreen) {
            // ‰øùÂ≠òÁºñËæëÈ°π‰ø°ÊÅØÔºåÂõ†‰∏∫closeModal‰ºöÂ∞ÜÂÖ∂ËÆæ‰∏∫null
            const editType = editingItem.type;
            const editCategory = editingItem.category;

            // ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÔºåÂè™ÂÖ≥Èó≠ÁºñËæëÊ®°ÊÄÅÊ°ÜÔºåÂà∑Êñ∞ÂÖ®Â±èÂÜÖÂÆπ
            closeModal();
            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆÂπ∂Âà∑Êñ∞ÂÖ®Â±èÊòæÁ§∫
            await loadData(editCategory);
            if (editType === 'synonym' && currentData[editCategory]?.synonyms) {
              openFullscreenSynonyms(editCategory);
            } else if (editType === 'hypernym' && currentData[editCategory]?.hypernyms) {
              openFullscreenHypernyms(editCategory);
            }
          } else {
            // ÊôÆÈÄöÁºñËæëÊ®°Âºè
            closeModal();
            loadData(currentCategory);
          }
        } else {
          const errorText = await response.text();
          console.error('Submit failed:', response.status, errorText);
          alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (error) {
        console.error('Submit failed:', error);
        alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      }
    }
    
    async function submitHypernym() {
      // Êî∂ÈõÜ‰∏ä‰πâËØç
      const upperWords = [];
      document.querySelectorAll('#hypernymUpperInputs .synonym-input-row').forEach(row => {
        const wordInput = row.querySelector('.hypernym-word');
        const defInput = row.querySelector('.hypernym-def');
        if (wordInput && wordInput.value.trim()) {
          upperWords.push({
            word: wordInput.value.trim(),
            definition: defInput ? defInput.value.trim() : ''
          });
        }
      });

      // Êî∂ÈõÜ‰∏ã‰πâËØç
      const lowerWords = [];
      document.querySelectorAll('#hypernymLowerInputs .synonym-input-row').forEach(row => {
        const wordInput = row.querySelector('.hypernym-word');
        const defInput = row.querySelector('.hypernym-def');
        if (wordInput && wordInput.value.trim()) {
          lowerWords.push({
            word: wordInput.value.trim(),
            definition: defInput ? defInput.value.trim() : ''
          });
        }
      });

      if (upperWords.length === 0 && lowerWords.length === 0) {
        alert('ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏Ä‰∏™‰∏ä‰πâËØçÊàñ‰∏ã‰πâËØç');
        return;
      }

      const title = document.getElementById('hypernymTitle').value.trim();
      console.log('Submitting hypernym:', {upperWords, lowerWords, title, currentToken: currentToken ? 'exists' : 'null'});

      try {
        let url = `/api/study_techniques/hypernyms/${currentCategory}`;
        let method = 'POST';

        // Â¶ÇÊûúÊòØÁºñËæëÊ®°Âºè
        if (editingItem && editingItem.type === 'hypernym') {
          url += `/${editingItem.id}`;
          method = 'PUT';
        }

        const requestData = {
          upper_words: upperWords,
          lower_words: lowerWords,
          ...(title ? {title} : {})
        };

        console.log('Sending request:', {url, method, data: requestData});

        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify(requestData)
        });

        console.log('Response status:', response.status);

        if (response.ok) {
          const result = await response.json();
          console.log('Submit successful:', result);

          // Ê£ÄÊü•ÊòØÂê¶ÊòØ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÁöÑ
          if (editingItem && editingItem.isFullscreen) {
            // ‰øùÂ≠òÁºñËæëÈ°π‰ø°ÊÅØÔºåÂõ†‰∏∫closeModal‰ºöÂ∞ÜÂÖ∂ËÆæ‰∏∫null
            const editType = editingItem.type;
            const editCategory = editingItem.category;

            // ‰ªéÂÖ®Â±èÁä∂ÊÄÅÁºñËæëÔºåÂè™ÂÖ≥Èó≠ÁºñËæëÊ®°ÊÄÅÊ°ÜÔºåÂà∑Êñ∞ÂÖ®Â±èÂÜÖÂÆπ
            closeModal();
            // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆÂπ∂Âà∑Êñ∞ÂÖ®Â±èÊòæÁ§∫
            await loadData(editCategory);
            if (editType === 'synonym' && currentData[editCategory]?.synonyms) {
              openFullscreenSynonyms(editCategory);
            } else if (editType === 'hypernym' && currentData[editCategory]?.hypernyms) {
              openFullscreenHypernyms(editCategory);
            }
          } else {
            // ÊôÆÈÄöÁºñËæëÊ®°Âºè
            closeModal();
            loadData(currentCategory);
          }
        } else {
          const errorText = await response.text();
          console.error('Submit failed:', response.status, errorText);
          alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (error) {
        console.error('Submit failed:', error);
        alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      }
    }
    
    async function submitTechnique() {
      const title = document.getElementById('techniqueTitle').value;
      const content = document.getElementById('techniqueContent').value;
      
      try {
        let url = `/api/study_techniques/techniques/${currentCategory}`;
        let method = 'POST';
        
        // Â¶ÇÊûúÊòØÁºñËæëÊ®°Âºè
        if (editingItem && editingItem.type === 'technique') {
          url += `/${editingItem.id}`;
          method = 'PUT';
        }
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify({
            title,
            content
          })
        });
        
        if (response.ok) {
          closeModal();
          editingItem = null;
          loadData(currentCategory);
        } else {
          alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      } catch (error) {
        console.error('Submit failed:', error);
        alert('‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');
      }
    }
    
    // Âà†Èô§Êìç‰ΩúÔºàÂ∏¶Âä®ÊïàÔºâ
    async function deleteSynonym(category, id) {
      if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËØçÊ±áÊõøÊç¢ÂêóÔºü')) return;

      console.log(`Ê≠£Âú®Âà†Èô§ËØçÊ±áÊõøÊç¢: ${category}/${id}`);

      // Ê∑ªÂä†Âà†Èô§Âä®Êïà
      const itemElement = event.target.closest('.item');
      if (itemElement) {
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-100%)';

        // Á≠âÂæÖÂä®ÊïàÂÆåÊàêÂêéÂÜçÊâßË°åÂà†Èô§
        setTimeout(async () => {
          try {
            const response = await fetch(`/api/study_techniques/synonyms/${category}/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${currentToken}` }
            });

            console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

            if (response.ok) {
              console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞Êï∞ÊçÆ');
              await loadData(category);
            } else {
              // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
              itemElement.style.opacity = '1';
              itemElement.style.transform = 'translateX(0)';
              const errorText = await response.text();
              console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
              alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
          } catch (error) {
            // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
            itemElement.style.opacity = '1';
            itemElement.style.transform = 'translateX(0)';
            console.error('Âà†Èô§Â§±Ë¥•:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }, 300);
      } else {
        // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÖÉÁ¥†ÔºåÁõ¥Êé•ÊâßË°åÂà†Èô§
        try {
          const response = await fetch(`/api/study_techniques/synonyms/${category}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${currentToken}` }
          });

          console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

          if (response.ok) {
            console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞Êï∞ÊçÆ');
            await loadData(category);
          } else {
            const errorText = await response.text();
            console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        } catch (error) {
          console.error('Âà†Èô§Â§±Ë¥•:', error);
          alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      }
    }

    async function deleteHypernym(category, id) {
      if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰∏ä‰∏ã‰πâËØçÂêóÔºü')) return;

      console.log(`Ê≠£Âú®Âà†Èô§‰∏ä‰∏ã‰πâËØç: ${category}/${id}`);

      // Ê∑ªÂä†Âà†Èô§Âä®Êïà
      const itemElement = event.target.closest('.item');
      if (itemElement) {
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-100%)';

        // Á≠âÂæÖÂä®ÊïàÂÆåÊàêÂêéÂÜçÊâßË°åÂà†Èô§
        setTimeout(async () => {
          try {
            const response = await fetch(`/api/study_techniques/hypernyms/${category}/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${currentToken}` }
            });

            console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

            if (response.ok) {
              console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞Êï∞ÊçÆ');
              await loadData(category);
            } else {
              // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
              itemElement.style.opacity = '1';
              itemElement.style.transform = 'translateX(0)';
              const errorText = await response.text();
              console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
              alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
          } catch (error) {
            // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
            itemElement.style.opacity = '1';
            itemElement.style.transform = 'translateX(0)';
            console.error('Âà†Èô§Â§±Ë¥•:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }, 300);
      } else {
        // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÖÉÁ¥†ÔºåÁõ¥Êé•ÊâßË°åÂà†Èô§
        try {
          const response = await fetch(`/api/study_techniques/hypernyms/${category}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${currentToken}` }
          });

          console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

          if (response.ok) {
            console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞Êï∞ÊçÆ');
            await loadData(category);
          } else {
            const errorText = await response.text();
            console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        } catch (error) {
          console.error('Âà†Èô§Â§±Ë¥•:', error);
          alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      }
    }

    async function deleteTechnique(category, id) {
      if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂÅöÈ¢òÊäÄÂ∑ßÂêóÔºü')) return;

      // Ê∑ªÂä†Âà†Èô§Âä®Êïà
      const itemElement = event.target.closest('.item');
      if (itemElement) {
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-100%)';

        // Á≠âÂæÖÂä®ÊïàÂÆåÊàêÂêéÂÜçÊâßË°åÂà†Èô§
        setTimeout(async () => {
          try {
            const response = await fetch(`/api/study_techniques/techniques/${category}/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${currentToken}` }
            });

            if (response.ok) {
              await loadData(category);
            } else {
              // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
              itemElement.style.opacity = '1';
              itemElement.style.transform = 'translateX(0)';
              alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
          } catch (error) {
            // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
            itemElement.style.opacity = '1';
            itemElement.style.transform = 'translateX(0)';
            console.error('Delete failed:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }, 300);
      } else {
        // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÖÉÁ¥†ÔºåÁõ¥Êé•ÊâßË°åÂà†Èô§
        try {
          const response = await fetch(`/api/study_techniques/techniques/${category}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${currentToken}` }
          });

          if (response.ok) {
            await loadData(category);
          } else {
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        } catch (error) {
          console.error('Delete failed:', error);
          alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      }
    }

    // ÂÖ®Â±èÂà†Èô§ÂäüËÉΩÔºàÂ∏¶Âä®ÊïàÔºâ
    async function deleteFullscreenSynonym(category, id) {
      if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËØçÊ±áÊõøÊç¢ÁªÑÂêóÔºü')) return;

      console.log(`Ê≠£Âú®Âà†Èô§ÂÖ®Â±èËØçÊ±áÊõøÊç¢: ${category}/${id}`);

      // Ê∑ªÂä†Âà†Èô§Âä®Êïà
      const itemElement = event.target.closest('.item');
      if (itemElement) {
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-100%)';

        // Á≠âÂæÖÂä®ÊïàÂÆåÊàêÂêéÂÜçÊâßË°åÂà†Èô§
        setTimeout(async () => {
          try {
            const response = await fetch(`/api/study_techniques/synonyms/${category}/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${currentToken}` }
            });

            console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

            if (response.ok) {
              console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞ÂÖ®Â±èÊï∞ÊçÆ');
              // Âà∑Êñ∞Êú¨Âú∞Êï∞ÊçÆ
              await loadData(category);
              // ÈáçÊñ∞ÊâìÂºÄÂÖ®Â±è
              openFullscreenSynonyms(category);
            } else {
              // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
              itemElement.style.opacity = '1';
              itemElement.style.transform = 'translateX(0)';
              const errorText = await response.text();
              console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
              alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
          } catch (error) {
            // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
            itemElement.style.opacity = '1';
            itemElement.style.transform = 'translateX(0)';
            console.error('Âà†Èô§Â§±Ë¥•:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }, 300);
      } else {
        // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÖÉÁ¥†ÔºåÁõ¥Êé•ÊâßË°åÂà†Èô§
        try {
          const response = await fetch(`/api/study_techniques/synonyms/${category}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${currentToken}` }
          });

          console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

          if (response.ok) {
            console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞ÂÖ®Â±èÊï∞ÊçÆ');
            // Âà∑Êñ∞Êú¨Âú∞Êï∞ÊçÆ
            await loadData(category);
            // ÈáçÊñ∞ÊâìÂºÄÂÖ®Â±è
            openFullscreenSynonyms(category);
          } else {
            const errorText = await response.text();
            console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        } catch (error) {
          console.error('Âà†Èô§Â§±Ë¥•:', error);
          alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      }
    }

    async function deleteFullscreenHypernym(category, id) {
      if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰∏ä‰∏ã‰πâËØçÁªÑÂêóÔºü')) return;

      console.log(`Ê≠£Âú®Âà†Èô§ÂÖ®Â±è‰∏ä‰∏ã‰πâËØç: ${category}/${id}`);

      // Ê∑ªÂä†Âà†Èô§Âä®Êïà
      const itemElement = event.target.closest('.item');
      if (itemElement) {
        itemElement.style.transition = 'all 0.3s ease';
        itemElement.style.opacity = '0';
        itemElement.style.transform = 'translateX(-100%)';

        // Á≠âÂæÖÂä®ÊïàÂÆåÊàêÂêéÂÜçÊâßË°åÂà†Èô§
        setTimeout(async () => {
          try {
            const response = await fetch(`/api/study_techniques/hypernyms/${category}/${id}`, {
              method: 'DELETE',
              headers: { 'Authorization': `Bearer ${currentToken}` }
            });

            console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

            if (response.ok) {
              console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞ÂÖ®Â±èÊï∞ÊçÆ');
              // Âà∑Êñ∞Êú¨Âú∞Êï∞ÊçÆ
              await loadData(category);
              // ÈáçÊñ∞ÊâìÂºÄÂÖ®Â±è
              openFullscreenHypernyms(category);
            } else {
              // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
              itemElement.style.opacity = '1';
              itemElement.style.transform = 'translateX(0)';
              const errorText = await response.text();
              console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
              alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
            }
          } catch (error) {
            // ÊÅ¢Â§çÂÖÉÁ¥†Áä∂ÊÄÅ
            itemElement.style.opacity = '1';
            itemElement.style.transform = 'translateX(0)';
            console.error('Âà†Èô§Â§±Ë¥•:', error);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        }, 300);
      } else {
        // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÖÉÁ¥†ÔºåÁõ¥Êé•ÊâßË°åÂà†Èô§
        try {
          const response = await fetch(`/api/study_techniques/hypernyms/${category}/${id}`, {
            method: 'DELETE',
            headers: { 'Authorization': `Bearer ${currentToken}` }
          });

          console.log(`Âà†Èô§ÂìçÂ∫îÁä∂ÊÄÅ:`, response.status);

          if (response.ok) {
            console.log('Âà†Èô§ÊàêÂäüÔºåÂà∑Êñ∞ÂÖ®Â±èÊï∞ÊçÆ');
            // Âà∑Êñ∞Êú¨Âú∞Êï∞ÊçÆ
            await loadData(category);
            // ÈáçÊñ∞ÊâìÂºÄÂÖ®Â±è
            openFullscreenHypernyms(category);
          } else {
            const errorText = await response.text();
            console.error('Âà†Èô§Â§±Ë¥•:', response.status, errorText);
            alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
          }
        } catch (error) {
          console.error('Âà†Èô§Â§±Ë¥•:', error);
          alert('Âà†Èô§Â§±Ë¥•ÔºåËØ∑ÈáçËØï');
        }
      }
    }

    // ÂÖ®Â±èÁºñËæëÂäüËÉΩÔºàÊîØÊåÅÂêå‰πâËØçÂíå‰∏ä‰∏ã‰πâËØçÔºâ
    function editFullscreenSynonym(category, id) {
      const data = currentData[category]?.synonyms || [];
      const item = data.find(item => item.id === id);
      if (!item) return;

      // Â°´ÂÖÖÊ†áÈ¢ò
      document.getElementById('synonymTitle').value = item.title || '';

      // Ê∏ÖÁ©∫Âπ∂Â°´ÂÖÖÂêå‰πâËØçËæìÂÖ•
      const container = document.getElementById('synonymInputs');
      container.innerHTML = '';
      item.synonyms.forEach(syn => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="Âêå‰πâËØç" class="form-input synonym-word" value="${syn.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input synonym-def" value="${syn.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeSynonymInput(this)">Âà†Èô§</button>
        `;
        container.appendChild(div);
      });

      // ËÆæÁΩÆÁºñËæëÊ®°Âºè
      editingItem = {type: 'synonym', category, id, isFullscreen: true};
      document.querySelector('#synonymModal .modal-header').textContent = 'ÁºñËæëËØçÊ±áÊõøÊç¢';
      document.getElementById('synonymModal').classList.add('show');

      // ‰øùÊåÅÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÊâìÂºÄÔºåÁºñËæëÊ®°ÊÄÅÊ°Ü‰ºöÊòæÁ§∫Âú®ÂÖ®Â±è‰πã‰∏ä
    }

    function editFullscreenHypernym(category, id) {
      const data = currentData[category]?.hypernyms || [];
      const item = data.find(item => item.id === id);
      if (!item) return;

      // Â°´ÂÖÖÊ†áÈ¢ò
      document.getElementById('hypernymTitle').value = item.title || '';

      // Â°´ÂÖÖ‰∏ä‰πâËØç
      const upperContainer = document.getElementById('hypernymUpperInputs');
      upperContainer.innerHTML = '';
      (item.upper_words || []).forEach(upper => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ä‰πâËØç" class="form-input hypernym-word" value="${upper.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def" value="${upper.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'upper')">Âà†Èô§</button>
        `;
        upperContainer.appendChild(div);
      });

      // Â°´ÂÖÖ‰∏ã‰πâËØç
      const lowerContainer = document.getElementById('hypernymLowerInputs');
      lowerContainer.innerHTML = '';
      (item.lower_words || []).forEach(lower => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ã‰πâËØç" class="form-input hypernym-word" value="${lower.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def" value="${lower.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'lower')">Âà†Èô§</button>
        `;
        lowerContainer.appendChild(div);
      });

      // ËÆæÁΩÆÁºñËæëÊ®°Âºè
      editingItem = {type: 'hypernym', category, id, isFullscreen: true};
      document.querySelector('#hypernymModal .modal-header').textContent = 'ÁºñËæë‰∏ä‰∏ã‰πâËØç';
      document.getElementById('hypernymModal').classList.add('show');

      // ‰øùÊåÅÂÖ®Â±èÊ®°ÊÄÅÊ°ÜÊâìÂºÄÔºåÁºñËæëÊ®°ÊÄÅÊ°Ü‰ºöÊòæÁ§∫Âú®ÂÖ®Â±è‰πã‰∏ä
    }
    
    // ÁºñËæëÂäüËÉΩ
    function editSynonym(category, id) {
      // ÊâæÂà∞Ë¶ÅÁºñËæëÁöÑÈ°πÁõÆ
      const data = currentData[category]?.synonyms || [];
      const item = data.find(item => item.id === id);
      if (!item) return;

      // Â°´ÂÖÖÊ†áÈ¢ò
      document.getElementById('synonymTitle').value = item.title || '';

      // Ê∏ÖÁ©∫Âπ∂Â°´ÂÖÖÂêå‰πâËØçËæìÂÖ•
      const container = document.getElementById('synonymInputs');
      container.innerHTML = '';
      item.synonyms.forEach(syn => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="Âêå‰πâËØç" class="form-input synonym-word" value="${syn.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input synonym-def" value="${syn.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeSynonymInput(this)">Âà†Èô§</button>
        `;
        container.appendChild(div);
      });
      
      // ËÆæÁΩÆÁºñËæëÊ®°Âºè
      editingItem = {type: 'synonym', category, id};
      document.querySelector('#synonymModal .modal-header').textContent = 'ÁºñËæëËØçÊ±áÊõøÊç¢';
      document.getElementById('synonymModal').classList.add('show');
    }
    
    function editHypernym(category, id) {
      // ÊâæÂà∞Ë¶ÅÁºñËæëÁöÑÈ°πÁõÆ
      const data = currentData[category]?.hypernyms || [];
      const item = data.find(item => item.id === id);
      if (!item) return;

      // Â°´ÂÖÖÊ†áÈ¢ò
      document.getElementById('hypernymTitle').value = item.title || '';

      // Â°´ÂÖÖ‰∏ä‰πâËØç
      const upperContainer = document.getElementById('hypernymUpperInputs');
      upperContainer.innerHTML = '';
      (item.upper_words || []).forEach(upper => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ä‰πâËØç" class="form-input hypernym-word" value="${upper.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def" value="${upper.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'upper')">Âà†Èô§</button>
        `;
        upperContainer.appendChild(div);
      });
      
      // Â¶ÇÊûúÊ≤°Êúâ‰∏ä‰πâËØçÔºåÊ∑ªÂä†‰∏Ä‰∏™Á©∫ÁöÑËæìÂÖ•Ê°Ü
      if (!item.upper_words || item.upper_words.length === 0) {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ä‰πâËØç" class="form-input hypernym-word">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'upper')">Âà†Èô§</button>
        `;
        upperContainer.appendChild(div);
      }
      
      // Â°´ÂÖÖ‰∏ã‰πâËØç
      const lowerContainer = document.getElementById('hypernymLowerInputs');
      lowerContainer.innerHTML = '';
      (item.lower_words || []).forEach(lower => {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ã‰πâËØç" class="form-input hypernym-word" value="${lower.word}">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def" value="${lower.definition || ''}">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'lower')">Âà†Èô§</button>
        `;
        lowerContainer.appendChild(div);
      });
      
      // Â¶ÇÊûúÊ≤°Êúâ‰∏ã‰πâËØçÔºåÊ∑ªÂä†‰∏Ä‰∏™Á©∫ÁöÑËæìÂÖ•Ê°Ü
      if (!item.lower_words || item.lower_words.length === 0) {
        const div = document.createElement('div');
        div.className = 'synonym-input-row';
        div.innerHTML = `
          <input type="text" placeholder="‰∏ã‰πâËØç" class="form-input hypernym-word">
          <input type="text" placeholder="Èáä‰πâ" class="form-input hypernym-def">
          <button type="button" class="remove-synonym" onclick="removeHypernymInput(this, 'lower')">Âà†Èô§</button>
        `;
        lowerContainer.appendChild(div);
      }
      
      // ËÆæÁΩÆÁºñËæëÊ®°Âºè
      editingItem = {type: 'hypernym', category, id};
      document.querySelector('#hypernymModal .modal-header').textContent = 'ÁºñËæë‰∏ä‰∏ã‰πâËØç';
      document.getElementById('hypernymModal').classList.add('show');
    }
    
    function editTechnique(category, id) {
      // ÊâæÂà∞Ë¶ÅÁºñËæëÁöÑÈ°πÁõÆ
      const data = currentData[category]?.techniques || [];
      const item = data.find(item => item.id === id);
      if (!item) return;
      
      // Â°´ÂÖÖË°®Âçï
      document.getElementById('techniqueTitle').value = item.title;
      document.getElementById('techniqueContent').value = item.content;
      
      // ËÆæÁΩÆÁºñËæëÊ®°Âºè
      editingItem = {type: 'technique', category, id};
      document.querySelector('#techniqueModal .modal-header').textContent = 'ÁºñËæëÂÅöÈ¢òÊäÄÂ∑ß';
      document.getElementById('techniqueModal').classList.add('show');
    }
    
    // ÂÖ®Â±ÄÂèòÈáèÂ≠òÂÇ®ÂΩìÂâçÊï∞ÊçÆÂíåÁºñËæëÁä∂ÊÄÅ
    let currentData = {};
    let editingItem = null;
    let fullscreenTechnique = null;
    let currentUploadType = null;
    let currentUploadCategory = null;
    let fullscreenType = null;
    let fullscreenCategory = null;
    let fullscreenLayout = 'narrow'; // 'narrow' or 'wide'


    // MarkdownÈÖçÁΩÆÂíåÂàùÂßãÂåñ
    function initMarkdown() {
      // ÈÖçÁΩÆmarked.js
      marked.setOptions({
        breaks: true, // ÊîØÊåÅGitHubÈ£éÊ†ºÁöÑÊç¢Ë°å
        gfm: true, // ÂêØÁî®GitHubÈ£éÊ†ºMarkdown
        headerIds: true, // ‰∏∫Ê†áÈ¢òÊ∑ªÂä†ID
        mangle: false, // ‰∏ç‰øÆÊîπÈÇÆÁÆ±Âú∞ÂùÄ
        highlight: function(code, language) {
          // ‰ΩøÁî®highlight.jsËøõË°å‰ª£Á†ÅÈ´ò‰∫Æ
          if (language && hljs.getLanguage(language)) {
            try {
              return hljs.highlight(code, { language }).value;
            } catch (err) {
              console.warn('Highlighter error:', err);
            }
          }
          // Â¶ÇÊûúÊ≤°ÊúâÊåáÂÆöËØ≠Ë®ÄÊàñÈ´ò‰∫ÆÂ§±Ë¥•Ôºå‰ΩøÁî®Ëá™Âä®Ê£ÄÊµã
          try {
            return hljs.highlightAuto(code).value;
          } catch (err) {
            console.warn('Auto highlighter error:', err);
          }
          return code; // ÈôçÁ∫ßÂà∞ÂéüÂßã‰ª£Á†Å
        }
      });

      // ÈÖçÁΩÆmarked‰ª•ÊîØÊåÅÊõ¥Â§öHTMLÊ†áÁ≠æ
      marked.use({
        extensions: [
          // ÊîØÊåÅ‰∏ãÂàíÁ∫øËØ≠Ê≥ï ++text++
          {
            name: 'underline',
            level: 'inline',
            start: (src) => src.match(/\+\+/)? src.indexOf('++') : -1,
            tokenizer: (src, tokens) => {
              const rule = /^\+\+([^\+]+(?:\+?[^\+]+)*)\+\+/;
              const match = rule.exec(src);
              if (match) {
                return {
                  type: 'underline',
                  raw: match[0],
                  text: match[1]
                };
              }
            },
            renderer: (token) => `<u>${token.text}</u>`
          },
          // ÊîØÊåÅÈ´ò‰∫ÆËØ≠Ê≥ï ==text==
          {
            name: 'highlight',
            level: 'inline',
            start: (src) => src.match(/==/)? src.indexOf('==') : -1,
            tokenizer: (src, tokens) => {
              const rule = /^==([^=]+(?:=?[^=]+)*)==/;
              const match = rule.exec(src);
              if (match) {
                return {
                  type: 'highlight',
                  raw: match[0],
                  text: match[1]
                };
              }
            },
            renderer: (token) => `<mark>${token.text}</mark>`
          }
        ]
      });
    }

    // ÂÆâÂÖ®ÁöÑMarkdownÊ∏≤ÊüìÂáΩÊï∞
    function renderMarkdown(content) {
      try {
        const html = marked.parse(content || '');
        return DOMPurify.sanitize(html);
      } catch (error) {
        console.error('Markdown rendering error:', error);
        return '<p>ÂÜÖÂÆπÊ∏≤ÊüìÂá∫Èîô</p>';
      }
    }

    // ÁîüÊàêÁõÆÂΩïÂáΩÊï∞
    function generateTableOfContents(markdownContent) {
      const tocContainer = document.getElementById('tocList');
      const tocWrapper = document.getElementById('fullscreenToc');
      const tocFloat = document.getElementById('fullscreenTocFloat');
      const tocToggleBtn = document.getElementById('tocToggleBtn');

      // Ëß£ÊûêMarkdown‰∏≠ÁöÑÊ†áÈ¢ò
      const headings = [];
      const lines = markdownContent.split('\n');

      lines.forEach((line, index) => {
        // ÂåπÈÖçATXÈ£éÊ†ºÁöÑÊ†áÈ¢ò (# ## ### Á≠â)
        const atxMatch = line.match(/^(#{1,6})\s+(.+)$/);
        if (atxMatch) {
          const level = atxMatch[1].length;
          const text = atxMatch[2].trim();
          headings.push({
            level: level,
            text: text,
            id: `heading-${index}`,
            lineIndex: index
          });
          return;
        }

        // ÂåπÈÖçSetextÈ£éÊ†ºÁöÑÊ†áÈ¢ò (=== Êàñ ---)
        if (index > 0 && (line.match(/^=+$/) || line.match(/^-+$/))) {
          const prevLine = lines[index - 1].trim();
          if (prevLine) {
            const level = line.match(/^=+$/) ? 1 : 2;
            headings.push({
              level: level,
              text: prevLine,
              id: `heading-${index - 1}`,
              lineIndex: index - 1
            });
          }
        }
      });

      // Â¶ÇÊûúÊ≤°ÊúâÊ†áÈ¢òÔºåÈöêËóèÁõÆÂΩï
      if (headings.length === 0) {
        tocFloat.style.display = 'none';
        return;
      }

      // ÁîüÊàêÁõÆÂΩïHTML
      let tocHtml = '';
      headings.forEach(heading => {
        const indentClass = `toc-h${heading.level}`;
        tocHtml += `<li class="toc-item">
          <a href="#${heading.id}" class="toc-link ${indentClass}" data-target="${heading.id}">
            ${heading.text}
          </a>
        </li>`;
      });

      tocContainer.innerHTML = tocHtml;

      // ‰∏∫ÂÜÖÂÆπ‰∏≠ÁöÑÊ†áÈ¢òÊ∑ªÂä†ID
      const contentElement = document.getElementById('fullscreenContent');
      const contentHeadings = contentElement.querySelectorAll('h1, h2, h3, h4, h5, h6');

      contentHeadings.forEach((heading, index) => {
        if (index < headings.length) {
          heading.id = headings[index].id;
        }
      });

      // ÊòæÁ§∫ÁõÆÂΩï
      tocFloat.style.display = 'block';

      // Ê£ÄÊü•Âπ∂ÊÅ¢Â§çÁî®Êà∑ÁöÑÊäòÂè†Áä∂ÊÄÅ
      const isCollapsed = localStorage.getItem('tocCollapsed') === 'true';
      if (isCollapsed) {
        collapseToc();
      } else {
        expandToc();
      }

      // Ê∑ªÂä†ÁõÆÂΩï‰∫§‰∫í‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞ÔºàÊäòÂè†/Â±ïÂºÄÔºâ
      function handleTocInteraction(e) {
        // Ê£ÄÊü•ÁÇπÂáªÁöÑÂÖÉÁ¥†ÊòØÂê¶ÊòØÊäòÂè†ÊåâÈíÆÊàñÂÖ∂Â≠êÂÖÉÁ¥†
        const isToggleButton = e.target.id === 'tocToggleBtn' ||
                              e.target.closest('#tocToggleBtn') !== null;

        // Â¶ÇÊûúÁõÆÂΩïÂ§Ñ‰∫éÊî∂Ëµ∑Áä∂ÊÄÅÔºå‰ªª‰ΩïÁÇπÂáªÈÉΩÂ∫îËØ•Â±ïÂºÄ
        if (tocWrapper.classList.contains('collapsed')) {
          e.preventDefault();
          e.stopPropagation();
          toggleToc();
          return;
        }

        // Â¶ÇÊûúÁõÆÂΩïÂ§Ñ‰∫éÂ±ïÂºÄÁä∂ÊÄÅÔºåÂè™ÊúâÁÇπÂáªÊäòÂè†ÊåâÈíÆÊâçÊî∂Ëµ∑
        if (isToggleButton) {
          e.preventDefault();
          e.stopPropagation();
          toggleToc();
          return;
        }
      }

      // Ê∑ªÂä†ÁõÆÂΩï‰∫§‰∫í‰∫ã‰ª∂ÔºàÊäòÂè†/Â±ïÂºÄÔºâ
      tocWrapper.addEventListener('click', handleTocInteraction);

      // ‰øùÂ≠ò‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞ÂºïÁî®‰ª•‰æøÂêéÁª≠Ê∏ÖÁêÜ
      tocWrapper._handleTocInteraction = handleTocInteraction;

      // Ê∑ªÂä†ÁõÆÂΩïÈìæÊé•ÁÇπÂáª‰∫ã‰ª∂
      tocContainer.addEventListener('click', handleTocClick);

      // Ê∑ªÂä†ÊªöÂä®ÁõëÂê¨Êù•È´ò‰∫ÆÂΩìÂâçÁõÆÂΩïÈ°π
      const contentContainer = document.querySelector('.fullscreen-modal');
      contentContainer.addEventListener('scroll', updateActiveTocItem);
    }

    // ÂàáÊç¢ÁõÆÂΩïÊäòÂè†Áä∂ÊÄÅ
    function toggleToc() {
      const tocFloat = document.getElementById('fullscreenTocFloat');
      const isCollapsed = tocFloat.classList.contains('collapsed');

      if (isCollapsed) {
        expandToc();
      } else {
        collapseToc();
      }
    }

    // Â±ïÂºÄÁõÆÂΩï
    function expandToc() {
      const tocFloat = document.getElementById('fullscreenTocFloat');
      const tocWrapper = document.getElementById('fullscreenToc');
      const tocToggleBtn = document.getElementById('tocToggleBtn');

      tocFloat.classList.remove('collapsed');
      tocWrapper.classList.remove('collapsed');
      tocToggleBtn.innerHTML = '‚óÄ';
      tocToggleBtn.title = 'Êî∂Ëµ∑ÁõÆÂΩï';

      // ‰øùÂ≠òÁä∂ÊÄÅ
      localStorage.setItem('tocCollapsed', 'false');
    }

    // Êî∂Ëµ∑ÁõÆÂΩï
    function collapseToc() {
      const tocFloat = document.getElementById('fullscreenTocFloat');
      const tocWrapper = document.getElementById('fullscreenToc');
      const tocToggleBtn = document.getElementById('tocToggleBtn');

      tocFloat.classList.add('collapsed');
      tocWrapper.classList.add('collapsed');
      tocToggleBtn.innerHTML = '‚ñ∂';
      tocToggleBtn.title = 'Â±ïÂºÄÁõÆÂΩï';

      // ‰øùÂ≠òÁä∂ÊÄÅ
      localStorage.setItem('tocCollapsed', 'true');
    }

    // Â§ÑÁêÜÁõÆÂΩïÁÇπÂáª‰∫ã‰ª∂
    function handleTocClick(event) {
      if (event.target.classList.contains('toc-link')) {
        event.preventDefault();
        const targetId = event.target.getAttribute('data-target');
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          // Âπ≥ÊªëÊªöÂä®Âà∞ÁõÆÊ†á‰ΩçÁΩÆ
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start',
            inline: 'nearest'
          });

          // Êõ¥Êñ∞Ê¥ªÂä®Áä∂ÊÄÅ
          updateActiveTocItem();
        }
      }
    }

    // Êõ¥Êñ∞Ê¥ªÂä®ÁõÆÂΩïÈ°π
    function updateActiveTocItem() {
      const tocLinks = document.querySelectorAll('.toc-link');
      const contentHeadings = document.querySelectorAll('#fullscreenContent h1, #fullscreenContent h2, #fullscreenContent h3, #fullscreenContent h4, #fullscreenContent h5, #fullscreenContent h6');

      let activeIndex = -1;
      const scrollTop = document.querySelector('.fullscreen-modal').scrollTop + 150; // ÂÅèÁßªÈáè

      // ÊâæÂà∞ÂΩìÂâçÂú®ËßÜÁ™ó‰∏≠ÁöÑÊ†áÈ¢ò
      for (let i = 0; i < contentHeadings.length; i++) {
        const heading = contentHeadings[i];
        const headingTop = heading.offsetTop;

        if (headingTop <= scrollTop) {
          activeIndex = i;
        } else {
          break;
        }
      }

      // Êõ¥Êñ∞ÁõÆÂΩïÈìæÊé•ÁöÑÊ¥ªÂä®Áä∂ÊÄÅ
      tocLinks.forEach((link, index) => {
        link.classList.remove('active');
        if (index === activeIndex) {
          link.classList.add('active');
        }
      });
    }

    // ÂÖ®Â±èÂ∏ÉÂ±ÄÂàáÊç¢ÂáΩÊï∞
    function setFullscreenLayout(layout) {
      const content = document.getElementById('fullscreenContent');
      const buttons = document.querySelectorAll('.layout-btn');

      // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
      buttons.forEach(btn => btn.classList.remove('active'));

      if (layout === 'narrow') {
        content.className = 'fullscreen-content fullscreen-narrow';
        document.querySelector('[onclick="setFullscreenLayout(\'narrow\')"]').classList.add('active');
        fullscreenLayout = 'narrow';
      } else if (layout === 'wide') {
        content.className = 'fullscreen-content fullscreen-wide';
        document.querySelector('[onclick="setFullscreenLayout(\'wide\')"]').classList.add('active');
        fullscreenLayout = 'wide';
      }

      // ‰øùÂ≠òÁî®Êà∑ÂÅèÂ•ΩÂà∞localStorage
      localStorage.setItem('fullscreenLayout', layout);
    }

    // Âä†ËΩΩÁî®Êà∑Â∏ÉÂ±ÄÂÅèÂ•Ω
    function loadFullscreenLayoutPreference() {
      const saved = localStorage.getItem('fullscreenLayout');
      if (saved === 'wide') {
        setFullscreenLayout('wide');
      } else {
        setFullscreenLayout('narrow');
      }
    }

    // Ë°®Âçï‰∫ã‰ª∂ÁªëÂÆö
    document.getElementById('synonymForm').addEventListener('submit', (e) => {
      e.preventDefault();
      submitSynonym();
    });

    // È°µÈù¢ÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', function() {
      // ÂàùÂßãÂåñÂ∞ÜÂú®window.onload‰∏≠Â§ÑÁêÜ
    });
    
    document.getElementById('hypernymForm').addEventListener('submit', (e) => {
      e.preventDefault();
      submitHypernym();
    });
    
    document.getElementById('techniqueForm').addEventListener('submit', (e) => {
      e.preventDefault();
      submitTechnique();
    });

    document.getElementById('fileUploadForm').addEventListener('submit', handleFileUpload);
    
    // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });
    });
    
    // ÂàùÂßãÂåñ
    window.onload = function(){
      // ÂàùÂßãÂåñMarkdown
      initMarkdown();

      checkStoredToken().then(valid=>{
        if(valid) {
          showUserInfo();
          initEventListeners();
          loadData('listening');
        } else {
          redirectToLogin();
        }
      });
    }
  </script>
  
  <!-- ÂÖ®Â±èÊ®°ÊÄÅÊ°Ü -->
  <div id="fullscreenModal" class="fullscreen-modal">
    <div class="fullscreen-header">
      <div class="fullscreen-left">
        <h1 class="fullscreen-title" id="fullscreenTitle">ÊäÄÂ∑ßËØ¶ÊÉÖ</h1>
        <div class="fullscreen-sort-controls" id="fullscreenSortControls" style="display: none;">
          <button class="sort-btn fullscreen-sort-btn active" onclick="sortFullscreenItems('desc')" title="ÊúÄÊñ∞Âú®Ââç">
            ‚Üì
          </button>
          <button class="sort-btn fullscreen-sort-btn" onclick="sortFullscreenItems('asc')" title="ÊúÄÊó©Âú®Ââç">
            ‚Üë
          </button>
        </div>
        <div class="layout-toggle" id="layoutToggle">
          <button class="layout-btn active" onclick="setFullscreenLayout('narrow')" title="Á™ÑËæπÂ∏ÉÂ±Ä">Á™ÑËæπ</button>
          <button class="layout-btn" onclick="setFullscreenLayout('wide')" title="ÂÆΩËæπÂ∏ÉÂ±Ä">ÂÆΩËæπ</button>
        </div>
      </div>
      <div class="fullscreen-actions">
        <button class="fullscreen-edit-btn" id="fullscreenEditBtn" onclick="enterFullscreenEditMode()">ÁºñËæë</button>
        <button class="fullscreen-save-btn" id="fullscreenSaveBtn" onclick="saveFullscreenEdit()" style="display: none;">‰øùÂ≠ò</button>
        <button class="fullscreen-close" onclick="closeFullscreenModal()">ÂÖ≥Èó≠</button>
      </div>
    </div>

    <!-- ÊµÆÂä®ÁõÆÂΩï -->
    <div class="fullscreen-toc-float" id="fullscreenTocFloat" style="display: none;">
      <div class="fullscreen-toc" id="fullscreenToc">
        <div class="fullscreen-toc-title">
          <span>üìñ ÁõÆÂΩï</span>
          <button class="toc-toggle-btn" id="tocToggleBtn" title="Êî∂Ëµ∑ÁõÆÂΩï">
            ‚óÄ
          </button>
        </div>
        <ul class="toc-list" id="tocList"></ul>
      </div>
    </div>

    <div class="fullscreen-main">
      <div class="fullscreen-content fullscreen-narrow" id="fullscreenContent"></div>
    </div>
    <div class="fullscreen-edit-area" id="fullscreenEditArea">
      <textarea class="fullscreen-textarea" id="fullscreenTextarea" placeholder="ËØ∑ËæìÂÖ•ÊäÄÂ∑ßÂÜÖÂÆπÔºåÊîØÊåÅMarkdownËØ≠Ê≥ï"></textarea>
    </div>
  </div>
</body>
</html>
