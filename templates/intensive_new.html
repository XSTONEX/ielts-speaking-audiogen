<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>新增文章 - 文章精读</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/static/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/android-chrome-512x512.png">
  
  <link href="https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Crimson+Text:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'PT Serif', 'Crimson Text', ui-serif, 'Times New Roman', 'Georgia', serif; background: #f6f8fb; margin:0; line-height: 1.6; color: #1f2937; letter-spacing: -0.05px; text-rendering: optimizeLegibility; font-kerning: normal; }
    .container { max-width: 820px; margin: 0 auto; background:#fff; min-height: 100vh; }
    h2 { text-align:center; color:#111827; margin:0 0 28px; font-size: 26px; font-weight: 400; letter-spacing: -0.2px; }
    .toolbar { display:flex; justify-content:flex-start; align-items:center; padding: 24px 32px 16px; border-bottom: 1px solid #e6ebf2; background: #fff; }
    .toolbar button { padding: 10px 20px; border:none; border-radius:12px; cursor:pointer; background:#f8fafc; color:#374151; font-weight:500; transition: all 0.2s; border: 1px solid #e2e8f0; }
    .toolbar button:hover { background:#e2e8f0; transform: translateY(-1px); }
    .section { padding: 32px; margin: 24px; background: #ffffff; border: 1px solid #e6ebf2; border-radius: 16px; box-shadow: 0 6px 18px rgba(15,23,42,0.04); }
    label { font-weight:600; color:#374151; font-size:15px; display: block; margin: 24px 0 8px; }
    label:first-of-type { margin-top: 0; }
    input[type="text"], select, textarea { width:100%; padding:14px 18px; border-radius:12px; border:1px solid #e5eaf0; background:#fff; font-size:15px; transition: all 0.2s; outline:none; font-family: 'PT Serif', 'Crimson Text', ui-serif, 'Times New Roman', 'Georgia', serif; letter-spacing: -0.1px; }
    input[type="text"]:focus, select:focus, textarea:focus { border-color:#667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.08); }
    textarea { min-height: 280px; resize: vertical; line-height: 1.55; }
    .btn { padding:14px 28px; border:none; border-radius:12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; font-weight:600; cursor:pointer; font-size: 15px; transition: all 0.3s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25); }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); }
    .btn:active { transform: translateY(0); }
    .muted { color:#6b7280; font-size:14px; margin-left: 16px; }
    .form-actions { display: flex; align-items: center; margin-top: 32px; }
    
    @media (max-width: 768px) {
      .container { margin: 0; }
      .toolbar { padding: 16px 20px 12px; }
      h2 { font-size: 24px; margin-bottom: 24px; }
      .section { padding: 24px 20px; }
      label { font-size: 14px; margin: 20px 0 8px; }
      input[type="text"], select, textarea { padding: 14px 16px; font-size: 15px; }
      textarea { min-height: 240px; }
      .btn { padding: 14px 28px; font-size: 15px; }
      .form-actions { flex-direction: column; align-items: stretch; gap: 12px; }
      .muted { margin-left: 0; margin-top: 8px; text-align: center; }
    }
    
    @media (max-width: 480px) {
      .toolbar { padding: 12px 16px; }
      .section { padding: 20px 16px; }
      input[type="text"], select, textarea { padding: 12px 14px; }
      .btn { padding: 12px 24px; }
    }
  </style>
</head>
<body>
  <div id="authOverlay" style="position:fixed;z-index:10000;left:0;top:0;width:100vw;height:100vh;background:rgba(240,245,255,0.98);display:flex;align-items:center;justify-content:center;">
    <div style="background:#fff;border-radius:14px;box-shadow:0 8px 32px 0 rgba(31,38,135,0.15);padding:38px 32px 32px 32px;max-width:90vw;min-width:320px;text-align:center;">
        <h2 style="color:#3b4a6b;margin-bottom:18px;">请输入访问密码</h2>
        <input id="authPassword" type="password" placeholder="Password" style="padding:12px 16px;font-size:17px;border-radius:8px;border:1.5px solid #d1d5db;width:80%;max-width:260px;outline:none;" autofocus onkeydown="if(event.key==='Enter'){checkPassword();}">
        <div id="authError" style="color:#e94e77;margin-top:14px;display:none;font-size:15px;">密码错误，请重试。</div>
        <button onclick="checkPassword()" style="margin-top:22px;width:60%;max-width:180px;">进入</button>
    </div>
  </div>
  <div class="container">
    <div class="toolbar">
      <button onclick="location.href='/intensive'">返回文章列表</button>
    </div>
    <h2>新增文章</h2>
    <div class="section">
      <label>分类</label>
      <select id="category">
        <option value="Reading">Reading</option>
        <option value="Listening">Listening</option>
        <option value="Writing">Writing</option>
      </select>
      <label style="margin-top:10px;display:block;">标题</label>
      <input id="title" type="text" placeholder="给你的文章起个标题（可选）">
      <label style="margin-top:10px;display:block;">粘贴你的长文章</label>
      <textarea id="content" placeholder="将整篇文章粘贴到这里。创建后正文不可修改，只能做高亮与注释。"></textarea>
      <div class="form-actions">
        <button class="btn" onclick="createArticle()">创建文章</button>
        <div id="createMsg" class="muted"></div>
      </div>
    </div>
  </div>

  <script>
    let currentToken=null;
    function fetchServerPassword(){ return fetch('/get_password').then(r=>r.json()); }
    function checkStoredToken(){ const tk=localStorage.getItem('authToken'); if(!tk) return Promise.resolve(false); return fetch('/verify_token',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({token:tk})}).then(r=>r.json()).then(d=>{ if(d.valid){ currentToken=tk; return true;} localStorage.removeItem('authToken'); return false; }).catch(()=>{ localStorage.removeItem('authToken'); return false; }); }
    function checkPassword(){ const val=document.getElementById('authPassword').value; fetch('/verify_password',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({password:val})}).then(r=>r.json()).then(d=>{ if(d.success){ currentToken=d.token; localStorage.setItem('authToken', d.token); document.getElementById('authOverlay').style.display='none'; document.body.style.overflow=''; } else { document.getElementById('authError').style.display=''; document.getElementById('authPassword').value=''; document.getElementById('authPassword').focus(); } }).catch(()=>{ document.getElementById('authError').style.display=''; }); }
    window.onload=function(){ checkStoredToken().then(valid=>{ if(valid){ if(document.getElementById('authOverlay')){ document.getElementById('authOverlay').style.display='none'; document.body.style.overflow=''; } } else { window.location.href='/login'; } }); }

    function createArticle(){ const title=document.getElementById('title').value.trim(); const category=document.getElementById('category').value; const content=document.getElementById('content').value; if(!content.trim()){ showCreateMsg('请粘贴文章内容', true); return; } fetch('/intensive_create',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({title, category, content})}).then(r=>r.json()).then(d=>{ if(d.success){ showCreateMsg('创建成功', false); setTimeout(()=>{ location.href = '/intensive'; }, 600); } else { showCreateMsg(d.error||'创建失败', true); } }); }
    function showCreateMsg(msg, isErr){ const el=document.getElementById('createMsg'); el.textContent=msg; el.style.color=isErr?'#ef4444':'#6b7280'; setTimeout(()=>{ el.textContent=''; }, 1500); }
  </script>
</body>
</html>


